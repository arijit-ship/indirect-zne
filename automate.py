"""
Automation for redundant and ZNE runs.
"""

import os
import yaml
import json
import subprocess

# === CONFIGURATION ===
OPTIMIZED_PARAM = [
      [
        1.5680106786222674e-17, 1.0238650999177359, 1.0238650999177359,
        1.0238650999177359, 1.7041550191762513, 2.070931805530806,
        2.586234954306046, 2.6265616878606783, 2.7566136785306155,
        2.7689271757054255, 4.271831894498143, 4.271831894498143,
        4.271831894498143, 5.004110362344359, 5.004110362344359,
        5.529689350278954, 5.529689350278954, 5.529689350278954,
        5.5493166460873375, 7.855838962179162, 7.855838962179162,
        8.508023697610218, 8.540796404638465, 8.940056981382925,
        8.940056981382925, 8.940056981382925, 8.940056981382925,
        9.524293982069336, 9.524293982069336, 9.815045396471412,
        0.717685470636315, 0.29125971197830336, 0.013619559122678915,
        -0.46174394022911175, -0.7802589318548062, 1.8785332138943256,
        -0.07718385116900997, -0.4181315830102034, 0.3859499067718677,
        0.7218523694763775, 0.16350787496293626, -0.06274337543165032,
        1.048639096314506, 0.9454500907927006, -0.18328208251477485,
        0.5336296017995852, 0.7047960543548563, -0.4717130073686535,
        -0.14327049451726778, 0.5646728024946054, 0.1377201649736573,
        1.0845662084088512, 0.7117671017527167, 1.8562916393289055,
        -1.0958742208007046, 0.314756410152813, 1.0055290931424188,
        -1.2653176839886926, -0.6435463058390287, -0.13689785210195535,
        0.5185042269644529, -0.07994120596020922, -1.3394312085309903,
        -0.01354724643952521, -0.8508707890759795, -0.7258020036409927,
        -0.1513648764845159, -0.5702686618598916, -0.20804467461705725,
        -0.059043388294177074, 0.9724468840137966, 1.6889388278999584,
        0.19460354666786345, 1.52688995899303, 0.40690710189505636,
        0.054839646577847824, -1.9384169999074634, -0.8955556931339368,
        0.22344394192624842, -2.4039574731682265, -0.22903568222623788,
        -0.008629533947631484, 1.3318794505555018, -0.04476169800775707,
        -0.5314892190926975, -0.05384939938166128, 0.5067524952638964,
        0.7555528952477042, 0.6437292330207226, 0.02590432636550948,
        0.44592066957482307, -0.0809779454755679, -1.1390483539597829,
        0.4898473400025203, 0.11381426982162568, 0.6089836387514223,
        0.17594570893388972, 0.012948010393531988, -0.547404644839424,
        0.028969189369927453, 1.1006601522977721, -0.6406183594181203,
        -0.12562720825840668, 2.0392738219317867, 0.9906966768182601,
        0.03179376057566713, 1.5460159269414353, -0.01674613470972367,
        -1.1841027420803907, 0.24496917335434354, -0.07332300856328518,
        0.25897293698241475, 0.35918978324443196, -0.007942172382781155,
        0.4618323110818234, -0.08547471514820712, -0.5115221242285567,
        0.4563488682048878, -1.2086759202201718, 0.14282176979415442,
        0.48263581465206523, 0.09855500655515351, 0.5327824526475502,
        -0.19110982084320108, -0.775795154813047, -0.31907838177549175,
        0.03477100089693282, 0.7436201132387485, -0.022209896476399357,
        -0.14741027177548285, -0.10110024079398225, 0.20359400710495562,
        -0.15623022021775929, 0.1964090589605299, 0.18042072654891128,
        0.8910666012551952, 0.03518277211157266, 0.11858050209575345,
        0.6912090997145024, 0.05142750966379351, 1.2523961498884204,
        -1.1477698487953947, -0.16063831357643202, -1.0074319345942784,
        0.29535289246662044, -0.002280412475169233, 0.45599081133710123,
        -1.6715207166067523, 0.3320227490012926, 1.5421306314740455
      ],
      [
        0.33528943002425843, 0.8608925283648261, 2.8309935233222867,
        2.8382233121900358, 2.847558790018716, 2.8477263794127468,
        3.9337993695450666, 3.9337993695450666, 3.9337993695450666,
        3.9337993695450666, 3.9337993695450666, 5.127462455084763,
        5.128383696390232, 5.132051241075024, 5.132231848473024,
        5.132297186784173, 5.132297186784173, 5.132297186784173,
        5.132320898992942, 5.134903164275234, 5.734798022200061,
        5.734798022200061, 5.734798022200061, 6.71748919093495,
        6.71748919093495, 9.773430860122208, 9.791656954875775,
        9.791980525916317, 9.804782964874805, 9.947289619134542,
        0.6818618664375632, 0.42253658736184846, 0.19067339209915313,
        -2.314563573529872, -1.7784854373672185, -0.10945476580518654,
        0.08980428543050965, 0.6265702304745648, -0.12016219313034968,
        0.005450784512528824, 0.9621316606784164, -0.01940541263687908,
        -1.2890091107885369, -0.09216272929775945, -0.8615487717558121,
        0.021600758375482327, 1.1068545366678577, -0.06436428812394061,
        -1.8186253546793636, -0.2455724158610742, 0.7444478114283775,
        1.0647343146888184, -1.6388802958603008, -0.05032235091912311,
        0.7589104637111997, 0.0934759886788552, 0.7280377617711271,
        -0.10012682423470079, -2.7917715562202794, 0.5843828201862561,
        1.2003794612588048, -0.2782652692858759, 1.253725179404932,
        -0.831140674623039, -1.3898002860152843, 1.7689493816619246,
        -0.768539740515663, -0.5265628815801298, -0.8222194498348508,
        -0.4525275176973082, 0.8944486767447871, 1.1352373194126446,
        0.06348552937029919, -0.7478835175458556, -0.44914670649658045,
        0.5247278033135997, 0.5948349944294522, -0.5743460857513,
        0.873550995352649, 0.8797938271812764, -0.37270941226617715,
        0.20553479070949218, 0.6188766136751805, -0.4012501825920459,
        -0.4763388197192611, -0.34431485887187113, -1.1697954599661295,
        0.5556509722807279, -0.5397649164737537, -0.41722730509388967,
        0.9275888618509817, 0.4371362266023078, -1.4110895986752616,
        0.6716489600966955, 0.08900519900900147, 0.7708643633651343,
        0.0944251249629154, -0.053131619179539805, -0.132883145931867,
        0.44414428660563765, -0.3164026614336652, 0.9835391768228284,
        -0.49696354121947833, 0.3510514174127117, -0.24991518010085176,
        -0.7780713458689107, 1.3387260017849976, 0.712191280671364,
        -0.4436070432657242, 1.090195713122469, 0.3876483875477464,
        1.113683201871723, 0.09724940056823322, -1.3265075307540413,
        -1.8530581309545013, 0.335564434910613, 0.16061631243062188,
        0.6994545842241634, -0.0055568765936962455, 1.8148369905661879,
        -0.9149620921846291, -0.5341673651010566, -0.6583203681162046,
        -0.05148037848607484, -0.1302834828824637, -0.2083684341417298,
        -0.7142637766159184, 0.4980789266978527, -2.030263033934291,
        -0.002330467371510849, -0.7835259213136883, -0.18712783689065152,
        -0.271594041353006, 0.606962231033315, 0.19917323339650786,
        0.581852597021436, 1.0547240409345577, 0.07111303544026976,
        1.4877210254684077, 0.08669172360020491, 0.8024105605127613,
        0.8315802366658298, 1.117305276662395, -1.0742437197416552,
        0.30921812342286065, -0.06994991433225481, 1.0419800264617582,
        1.4507701003592177, 0.2408413974211676, 1.6573761327725358
      ],
      [
        0.08591881204796584, 1.5026023651616802, 1.9179097588555833,
        1.9179097588555831, 1.9179097588555831, 1.9179097588555831,
        2.8800636946459592, 2.9523818900173797, 2.9523818900173797,
        2.954896407422686, 3.0487820562708485, 3.0487820562708485,
        3.9462134206000328, 3.9462134206000328, 5.170248653928018,
        5.170248653928018, 6.5066905594049205, 6.5066905594049205,
        6.5066905594049205, 6.914119522580601, 6.914119522580601,
        6.9842551957162815, 7.300516913785898, 8.782483894556266,
        8.782483894556266, 8.999633503017922, 8.999633503017922,
        8.999633503017922, 9.414122362394847, 9.414122362394847,
        0.09854676674938925, -0.05173289612974198, 0.30094803169630163,
        -1.1984142138894447, 0.08610670053567002, 0.2851928692216035,
        0.26177875477440216, 0.11764473243628538, 0.3495067876706816,
        -0.9678438601279628, -0.08762050677252062, 0.014826088936787857,
        -0.30347729159143555, -1.1730530788097624, -0.12550631929596553,
        2.258056275075482, -0.5160508087356981, 0.004541093619226378,
        -0.9345420797218197, 0.47154522212338745, -0.9129446894819914,
        0.2768683391341781, 0.29975752794333804, -0.16177915588279423,
        0.6021148977823381, 0.35405737535162146, 0.8149645603473178,
        -0.7074306860917636, -0.8281028342440522, -0.20840122350984505,
        -0.19593362207831977, 1.2208184674045053, -0.10408257731449277,
        0.9878855326441833, 0.6508295623732647, -0.31520021014255994,
        -1.502007043998756, -0.44913621684685756, -0.2831231513937543,
        -1.048170079126895, -0.10057118739311635, -0.4440190475287521,
        0.5925479388494825, 0.1500100176310508, -0.4655542365338734,
        0.09847924242741647, -0.25695620197439545, -0.5449201592551612,
        0.4987130755500597, -0.007720607194202524, 0.7816530161823243,
        -0.8246572495389679, -0.28480932751570914, 1.8751826609713358,
        -0.20740645402102328, -0.04894031202761418, -1.0170156037248201,
        -0.035476380392734465, 0.9940259955458774, -0.657126951929564,
        -0.4786936406484008, 1.4564140457987391, -1.062151832750044,
        -0.01496017231630948, 0.16259290081999456, 0.601493806263198,
        -0.20485253219607644, -1.2421776762345744, 1.152288606322054,
        1.1883019471730756, 0.9817659575699377, 0.9653429636905305,
        0.5382122852444811, 0.722384759736696, -0.13079560936986118,
        -0.9638314109375934, -0.13358671856975504, -0.3949417844115237,
        1.01780227278121, 0.6746960094686067, 0.14295933107831804,
        -0.37974724013569766, 0.3641245559377578, 0.12972678280008856,
        0.5949873255000262, 0.8499370211382984, -0.0792654431528575,
        1.9402087793428133, -0.5583113020357903, 0.6535986429024293,
        1.0008805619835928, 0.16556690201288055, 1.1071973338235597,
        0.07194244573338314, -0.9146859400815048, -0.005186820541518637,
        0.4795762978809806, 0.6475066336984044, 0.11860845746693519,
        0.08044881503693782, 0.5402817334108434, 1.5532870492056725,
        0.36643388228039625, 1.6150985923432208, 0.22271977417212363,
        -0.04956133994172771, -0.6258533610916538, -0.6517224443292691,
        0.2594825887888975, -0.1286341552665023, 0.48749759828242367,
        -0.009813928289633511, 0.5249350004928881, -0.01015655683116892,
        -0.48671658518654837, -0.588311268126242, -0.25978871509233853,
        0.9039610340757382, 1.5549616218831699, -0.05330158954092406
      ],
      [
        0.3773346757087749, 0.5734233884194113, 0.5734233884194113,
        1.2094818154974225, 1.2528672337957094, 1.3073966674132076,
        4.193348178434801, 4.228670385547864, 4.228670385547864,
        4.228670385547864, 4.228670385547864, 4.228670385547864,
        4.274742575727675, 5.343872214974395, 5.354523589318104,
        5.449133113124401, 5.449133113124401, 5.449133113124401,
        5.449133113124401, 6.208341300319731, 6.208341300319731,
        6.738723848778546, 6.7473872692498285, 8.515456463543387,
        8.552181104315652, 8.552181104315652, 8.552181104315652,
        9.363042150968939, 9.363042150968939, 11.478464454984158,
        -0.2683676450988651, -0.9370321768196137, 0.03790413469005285,
        -0.3520989510779511, 0.5131804204688105, 0.767748989456867,
        -1.1529933056041268, 1.0195402939041247, -0.5189860890713169,
        1.700377968800765, 0.48912124484584857, 1.506730848787325,
        0.4485612726223177, -1.6248073049289613, 0.10079320215400162,
        1.7454590745233427, 1.474284546585253, 0.08837986403943651,
        1.215839965531947, -0.42666568442503866, 0.04298065245990749,
        -1.495484471060033, 0.39055472334393304, -0.06187227108331559,
        1.0010296249342066, -0.33745943355443286, -0.19046242319241546,
        -0.4884459619425607, 0.8930564792122229, 0.09947441181287657,
        -1.4049039336860292, 1.0413688199593338, 0.027348986225077598,
        1.5457890290583323, 0.8022774572900748, -1.0377116853398,
        0.5652694406258009, 0.9990396087940023, -0.3409174955760714,
        -0.8590373420111477, 0.3662952964918326, 0.6492392290096071,
        -1.0735392409833318, -0.620775369578654, 0.5064494688850749,
        0.6065178361322348, 0.31795568319369283, -0.4388081557471054,
        0.07128954327413695, -0.07460186306053893, -1.5916050363108065,
        0.40348292639904854, 0.7429600006983637, 0.13897118193917846,
        0.13192395570874205, -0.560408177185694, -0.7293430452459922,
        1.2393938765994381, 0.16520016983754293, -0.04218705839108043,
        1.9844775109402493, -0.40811731341033075, 0.40494641878472026,
        0.44317505546879765, -0.14541224425415586, -1.3628454492957067,
        0.35572573997739254, -0.17363781014762678, -0.21765464091811726,
        0.25867396534698067, -0.19299239511743832, 0.842583631219517,
        0.01538577194684443, -1.3780712180305699, 0.30168991607554185,
        0.03816118508668757, -0.6330896266111891, -0.14462412237866193,
        0.22751230177420415, 2.198362599080823, 0.5538971259685714,
        1.6735676153080048, 0.01161307703421222, 0.15241612900647253,
        -0.4114895408906573, 0.020024246948836234, -0.361021382333633,
        1.2366726872792735, -0.8652479233612058, -0.38157323774943186,
        -1.2043495043519374, 0.03294448415473864, 1.864475600371399,
        -0.048446953541905424, 1.483038428004856, 0.02119809714572118,
        -0.20756566215919184, 1.2566509021622863, 0.4040298326697209,
        0.0492062183426151, 0.3396501220758691, 0.09097515161528406,
        -0.4545275805495163, 1.5327906096069877, -0.47568898039994184,
        0.7447654713950665, 0.7179833985093875, -0.03692927531761856,
        0.11509825242982577, 0.020898935398901888, 0.2387893529411216,
        1.5195379458286031, -0.5337205856413728, -0.5741707032781822,
        1.298358172715442, -0.010829860462227588, -1.9037204771139875,
        1.5774751765228583, -0.28550943128124906, 1.5531884118568244
      ],
      [
        -6.331146189926128e-17, 0.7069927066774304, 0.7069927066774304,
        0.7069927066774305, 0.7069927066774304, 1.0044153364322925,
        1.0092418692996383, 2.470333794214341, 2.478143749866421,
        3.5776564981759003, 3.5776564981759003, 3.5776564981759003,
        3.61745967653339, 3.6981780389472076, 3.755720232685741,
        3.9712286023902594, 3.9712286023902594, 4.519037432417192,
        4.519037432417193, 4.519037432417193, 5.280953883299406,
        5.280953883299406, 6.620356980277175, 6.620356980277175,
        6.620356980277175, 6.620356980277176, 8.214004051881032,
        8.214004051881032, 9.105951544537387, 10.829366164164977,
        1.4490195266558639, 1.145329650589643, -0.9374272684957279,
        -1.2910248872233119, 0.9701069453007352, 2.0238893871034924,
        -0.6731600678051081, -0.7305037462514778, 0.6743483023845589,
        1.611766624162738, -0.162446688913207, -0.2464021583836281,
        1.3073653685111934, 1.560629053845934, -0.09768282308379246,
        -0.31393750682085847, 0.1625705045557987, -0.1344649185634244,
        -0.03516682581352061, 0.15934568227883428, 1.4484389719925783,
        0.31346340320241645, -1.5406853809043388, 0.3831701903776482,
        0.07255447956326048, -0.4619144712511035, 0.6220101497739178,
        -0.08645510294766677, -0.036774035023737585, -0.02433291891195538,
        1.2745777688613118, 0.806643386980706, -0.1734465019831428,
        -1.474099767063678, -1.2534035864969235, 0.024086803725753666,
        -0.5946515656594247, 3.047855036387052, 0.561263952510902,
        -0.27353577574812815, 0.476385213099692, -0.4183083264972014,
        -0.07584344603997495, -0.04004176630390785, 0.6379867024754904,
        3.306912023625799, 0.6758488609505069, -0.49379826249780634,
        0.04089533617940984, 0.4062429454438471, -0.2647421675477994,
        0.1974729438666808, 0.043470303912556706, 0.2301819741695647,
        1.9247102260310271, 0.19401136489510468, 0.17784496580796996,
        -0.12037519976757159, 0.10596613899479704, 0.02480260398862852,
        0.33616247382037256, -0.2960626605489573, 1.2038327046358004,
        -0.4266046665751028, -0.14331073423696536, 0.33240571018120446,
        0.13743208352564132, 0.21308235615415505, -0.8816113951868988,
        -0.03958129872975694, 1.7385124490728345, 1.3953860705003918,
        0.7193393529381484, -0.5890148767931709, 1.6845229617798814,
        -0.04059142172715042, -0.6588344885662398, -1.5492107393137406,
        0.9886630320432893, 1.3955090248591298, -1.7521400718196618,
        -0.02012078102450614, 1.5598528019020075, -0.041272015671692544,
        0.6659176073691222, -0.10884895615623923, -0.8860283635501729,
        -0.042494102069769425, -0.5241060846215897, -0.049429521011899694,
        -1.6158837397685775, -0.29703279066650246, 0.6940812648197017,
        -1.0869617874060826, -1.1891726572683667, 0.03935191545498333,
        -1.7727595774952096, -0.0005664350349098603, -1.2288438066739866,
        2.182693040857262, 1.2648198022740724, 0.636776362006322,
        -1.1418938134635428, 0.04892386539982865, -0.6595482134655696,
        -0.016038133219537475, -1.53365152672916, -0.5818287115590742,
        -0.8537662908823758, 1.3418170063691075, -0.32888813707646736,
        -0.018460135902194714, -0.8323242421777916, 1.5026664500941838,
        1.809610363246633, -1.5283405786971713, 0.5470095670143573,
        -1.4753657998350065, 0.8122840148585063, 1.5317878779716176
      ],
      [
        3.750846163374531e-5, 0.22285241391868899, 0.26252411232084344,
        0.26252411232084344, 0.26252411232084344, 1.459545906754556,
        1.4595459067545562, 1.6094835194149661, 2.5927782099427628,
        2.5927782099427628, 2.5927782099427628, 2.5927782099427623,
        3.3552499939702187, 3.3552499939702187, 5.033284106467877,
        5.033284106467877, 5.056477210452712, 6.768913439946703,
        6.768913439946703, 7.2782492670747585, 7.2782492670747585,
        7.2782492670747585, 7.2782492670747585, 7.2782492670747585,
        7.2782492670747585, 8.934198246659292, 8.937369801451712,
        9.544406408519471, 9.544406408519471, 10.23170722265548,
        -0.4501443853573418, 0.06519513561037263, -0.13386490845883003,
        -0.01542333988020039, 0.3988203537526196, 0.9163371790808124,
        0.08159154039220383, -0.11665429084087826, -0.21130662780886203,
        1.515236372470638, 0.4436142129357345, -0.28780404896369716,
        0.3681425383234808, 0.648176841676201, 0.3046875502986337,
        0.05897820457762899, 0.09316951897603123, 1.5277657654344678,
        -0.655141628591867, 0.073084468489131, -0.11423944001370272,
        0.3986898081963471, 1.0974832156349317, 1.8462557861113,
        0.5998463368708868, -0.0014214294560794885, 0.4026665434776887,
        -0.03860309342262787, 0.3728818533964108, 1.7322816292529104,
        0.42156018976657544, 0.9872712539907578, 0.5749190583224287,
        0.1654949387796794, 1.0577776390475342, -0.5892377479966974,
        0.4324416138472369, 0.7909276553155474, 1.0132171075838867,
        0.008626434202972095, -1.4776636473003866, -0.0743310361925915,
        1.1363109745761366, 0.32003332101567866, 0.08535303128967886,
        1.1165485958252095, 0.476282782575683, 0.11414859665640108,
        0.8927652783900955, 0.027791184984770272, 0.8970588198442948,
        -0.04579755391586939, 0.10596016247070955, 0.4721342517962854,
        0.3142323996684511, -0.0207983447823891, 1.3304831617683006,
        -0.20639835153288702, 0.2928189752635581, -0.4120973709154422,
        -0.16251962266938982, -0.928532755338732, 0.13709877636127538,
        0.09386847134985479, -0.9415336108192559, -1.3861285848764584,
        0.5116476525314603, -1.5694556777668651, 0.31948518026769196,
        -0.0136576069296156, 0.8752899744519326, -0.448175539102687,
        -0.8567162669878051, 0.737642795798484, -0.5233142967805873,
        -0.020239952918795164, 0.9696407297918527, 1.064479355466651,
        -0.43102633401249074, 0.3234367312145231, 0.02606795235445944,
        0.2525608175326581, 0.09544790103129135, 0.30399471295861424,
        0.6638935631613432, 2.095756590649309, -0.5383535092385583,
        -0.1523671776118538, -0.49733805370513506, 1.0814777965289457,
        -0.5541810322110113, 0.4702060218904802, 0.1941018040115748,
        0.027389458133440587, -0.6339976476553459, 0.824073822166477,
        -0.8904328829691108, 0.5852778403101284, -0.37705413851354036,
        -0.20234246488211116, 0.19390975159216547, -0.03854894368679599,
        -0.5885610444718222, 0.2892174263372239, -0.7158388932188376,
        -0.03853087013753846, 0.36228239756074476, 0.06448164730191597,
        0.8103021451607575, 0.04195704491201313, 2.1946244272306323,
        1.1078290402756337, -0.0920096926231485, 0.7957980849005134,
        0.10683086015182242, 0.04139972880547422, 1.068477454710041,
        1.5812878062267348, 1.0292383703670558, 1.5822631942162138
      ],
      [
        0.003375513600300809, 0.4884127443235871, 0.6719352108785641,
        0.9073170135093351, 1.4946633690060278, 1.5076957064847494,
        3.872917838142945, 3.872917838142945, 3.872917838142945,
        3.872917838142945, 5.047622474508209, 5.054336886650782,
        5.067626550795242, 5.0733174878702085, 5.094629387163461,
        5.749571576552799, 5.7731554023304374, 7.144946717661993,
        7.144946717661993, 7.144946717661993, 7.144946717661993,
        7.602314289267704, 7.602314289267704, 8.018775147517832,
        8.018775147517832, 8.018775147517832, 8.018775147517832,
        8.018775147517832, 8.018775147517832, 9.661071929582006,
        0.2735947252101626, 2.471262065567802, 0.18954222370300397,
        0.2633058348660961, 0.07494334922808346, 1.4980157261935538,
        0.3538857424122425, 0.26341770410626436, 0.17174804107002956,
        -0.22912718472194316, 0.11060714764109056, -0.30804859927082595,
        2.8406850614439736, 1.0823654569610508, 0.9668529413216363,
        1.8727663516543385, -0.0901659930896485, 0.05868560690604535,
        0.24212775097742179, 1.0092515209898247, -0.7556969386491817,
        0.3279350524218167, 1.078117272505244, 0.10391815458190773,
        -0.7434930272741371, -1.6965388530236032, -1.360748554100242,
        0.34939560927302815, 0.03188634842980519, -1.2447472675125983,
        0.06092342743494014, 1.017082923902293, -1.007905562333318,
        -0.8576057837691866, 0.5321038189070756, 1.300652060018237,
        -1.8122591145188616, -1.247002191580596, 1.2529274198051785,
        0.3750417535596218, 0.2898066740735119, 1.589675559301449,
        2.3222772390172888, -1.568740409290771, 0.5925151941094322,
        -0.20655148780097043, -0.5059482271844034, -0.9561046882137155,
        -0.432249774596058, 1.8189144734584217, 0.6791516075394335,
        -0.10885247153326365, -2.2650870540994883, 0.2658818907332787,
        -0.9372958671062981, -1.0664167087973948, -0.7139434901419379,
        1.3816698348804732, 2.008892916411081, 0.15285666374274742,
        -1.782425531898792, 0.07791440554206944, -1.28397958204954,
        -0.7247696039786395, 0.5612678373457747, -0.004762916486662008,
        0.4386089298525658, 0.010283368626678616, 0.8990610129088383,
        0.03840864905637026, -1.2418081984826976, 0.33190310279028407,
        0.3061008622829172, -0.06950158836023225, 0.93859456058615,
        -0.02489786142317165, 0.9927840878492759, -0.0709710381209458,
        -1.4546153026559692, -0.6707274766895803, 1.0492831078613678,
        1.59883886587945, -0.7948795957139008, 0.011914265512354442,
        0.29611851635537545, -0.026452865362460363, 0.17911271593442915,
        -0.268102313362264, -0.31698956355176716, 0.5150163737561883,
        -0.2617344493849528, -0.08207987775663798, -0.7031192006515304,
        0.10296103394319861, -1.3322481995457, -0.8096620548125795,
        0.22894179493051453, -0.6404807766018014, 0.5981001234262467,
        0.6725836248662437, -0.24769451099401643, -1.5367942204876157,
        0.32496629998060117, 0.8231756699235411, 0.27229759145944715,
        -0.4283887626472357, 0.6783210911797265, 1.178917544999848,
        -0.48124012627536317, -0.23642700938756703, -0.22983768395119897,
        0.7841497681166887, 0.5963513861028734, -0.8505831212819382,
        0.6516631671421783, 0.6698405071431395, 0.7826636181190869,
        -1.6023915303224998, 0.6733061844063541, 1.5755992624240989
      ],
      [
        -5.647934061474703e-18, 1.4787834906243755, 1.478918229526628,
        1.478918229526628, 2.0077351764243123, 2.4302809101456218,
        2.4302809101456218, 3.009709563144601, 3.009709563144601,
        3.239471043198664, 3.2405283031129133, 3.2405283031129133,
        3.2656598154222434, 3.5353392937639825, 6.198713539858257,
        6.213604956994236, 6.73397854893658, 6.73397854893658,
        6.743547791194661, 6.744609103740889, 6.744609103740889,
        6.749543065628153, 6.749543065628153, 8.615256229309818,
        8.635090640841518, 9.012323512360366, 9.012323512360366,
        9.930483613907942, 9.930483613907942, 11.782061805135282,
        0.6870051227789642, 0.5234095533264759, 0.11216801162302814,
        0.044591843687496906, -0.747159787599118, 1.5727279855217766,
        -0.16958009141159439, -0.7234855106318131, 0.45999589631996707,
        1.3613822619347415, 0.5234464983029046, 0.18337466193510712,
        1.0660408011194182, 1.2813123812864906, 0.34899885807903364,
        1.2204971120849089, 0.37250493843195553, 0.3861568591798728,
        -0.4881036169368887, 0.23720347697856276, 0.8136369801063428,
        -0.8595161765585049, 0.6710512785075716, 0.5103741134651811,
        -0.48491784736765847, -1.939727949979543, 0.5221979500550953,
        -0.39618913325979604, -0.5258671175956018, 0.08753210163723862,
        1.3619602585721242, -1.2518915867901346, 0.1520244579503878,
        -1.126921262549515, -1.1285674400831274, -0.7045257843816373,
        -0.4468310259761979, 0.6091022847926961, 0.4198375873878555,
        0.5765253059135943, -2.8026328359302406, -1.7254430077855836,
        0.37020611055835473, 0.4465655907565091, -1.4308928069625704,
        1.6254306194316424, -0.16298810299835312, -1.249293985363804,
        -2.5283772945229797, -1.0735775181393186, -0.628541665091616,
        -1.1357659634071433, -0.5734897531715744, -1.6096579963890296,
        -0.8342055948126037, -1.5447846874108708, -1.1270394146554403,
        0.06392732561319403, 0.7711512775812011, -1.8472478314151175,
        -0.46160141905881696, 1.8963279721150403, -2.313663424814036,
        0.060952702837845166, -1.4971949982077863, 1.3040610818975555,
        0.10605679464403613, -1.138800572315487, -0.03947636943653289,
        0.07839455865010819, -0.6470277815644087, 0.946101637008616,
        -0.32144060478582315, -0.6371693991779968, 0.30580409265523,
        -0.2617129381706641, 0.4094287336545931, 0.49837362733711055,
        -0.9058714721495094, 0.6137893604415533, 0.8546844695081749,
        -0.8205470722456557, -0.598852289145785, 0.46823811794119646,
        1.2205247300232143, 0.031629319060699435, 1.1369587010491427,
        0.12298062775535874, -0.016960252964031076, 1.1127338626212067,
        0.37972118532018134, -0.1475616440844684, 0.32749925367563326,
        0.030050642250761914, 0.17169542743574548, -0.5825729547476518,
        0.7052714548722974, 0.9884296874822006, -0.500384308215816,
        0.01722431287494931, 0.40290712722731054, -0.029200452046427447,
        1.2704708243944813, 2.3709704014259345, -2.0267551524865275,
        0.7347873374577798, -0.34767223966060473, 0.009778943736386289,
        0.221000841842164, -0.010995780695540691, -0.481889271583797,
        0.7008500159073542, 2.3944065221124076, -0.08320445199579081,
        2.02470278988152, 0.02142760118000664, 1.6794429086669174,
        1.6046551807968945, 0.2831685070910348, 1.5805135598594935
      ],
      [
        0.0019047787007362745, 0.7201496918445128, 0.7201496918445128,
        0.7201496918445127, 0.7226708680142584, 0.8068041864232433,
        1.3847174673528184, 1.6031895944534578, 2.458865333289775,
        2.458865333289775, 2.721120236828938, 2.721120236828938,
        3.554687304897056, 3.554687304897056, 4.537252190232355,
        4.537252190232355, 5.239770593633025, 5.242363659304797,
        5.566731623636481, 5.566731623636481, 5.566731623636481,
        5.566731623636481, 5.566731623636481, 7.6484324534494865,
        7.6484324534494865, 8.96757120343865, 9.352637118466301,
        9.381932224950582, 9.966925955531599, 9.966925955531599,
        0.29840004251263574, 0.3207087147269936, -0.22478909909228914,
        -1.2242611593120782, 0.061748844824383295, 1.9931455249507801,
        0.02449362327304914, -0.23402928130657288, 0.3399922671860315,
        0.2355005268966802, 0.7912945290539132, -0.9147564287830934,
        0.12280724330167514, 0.42016875545313104, 0.6183328009701774,
        0.9098148543333162, 0.2439503202728901, 0.4941740976390827,
        0.0721485641264495, 0.20051214721509877, 0.14273239312798908,
        -0.03846070968482946, 0.11474641891065286, 0.1552743298359438,
        -0.050455466832234855, 0.24385918138398863, 0.0646818550964626,
        1.0379575003266166, 0.4438839418702803, 0.6652939620943935,
        0.6574583263339632, 0.6386444070388955, 0.30923240052603657,
        -0.34636230410321134, 0.23860747048870812, -0.8837469955189079,
        0.25272330748816335, -0.05865013289270936, 0.324900593333006,
        0.14494577696571714, -0.2063591527406891, 0.03616506891850059,
        0.47262902670638013, -1.0341740644891497, 0.05484745701468325,
        0.6503839058002072, 0.9852671145762593, -0.15013660688285613,
        -1.1623207819211936, -0.09407804105158574, -0.7141485635922941,
        -0.20002766061477661, 0.256318263131488, 1.811390397828268,
        -0.4480297381108074, -0.0031154151062657686, 0.685008095432428,
        -0.007804627058269528, -2.9100406031766375, -0.17918863042787767,
        -0.29620353111227854, -0.2953351498676352, 0.4434234593316091,
        0.0018987515325079429, 0.5290648024022053, 0.011057994967698829,
        0.03103232328752182, -0.21693206073792237, -0.07883582131375938,
        -0.2554965378040217, 1.978711034134111, -0.02822992907519939,
        1.110830733101554, 0.04155227001102173, 0.17370289874025888,
        -0.08435695708516765, 0.38686640173882947, 1.0727525781247964,
        -1.4871438236674412, 0.1437881416009117, -0.15769165641037303,
        0.46096388290194723, 0.3881288491041242, 0.3113157866411551,
        -0.21237825892214532, 1.3408904937177344, 0.033287678968192874,
        -0.22654084728278404, 0.09162287503278096, 1.1250326534568733,
        0.670327239820091, -1.4911819217025961, 0.8417198858779599,
        0.018685303562101165, -0.5955098452611822, 1.37350461224772,
        -0.5503685346151788, 0.07415629279393592, 0.22396953453102358,
        -0.02219350017922496, 2.5136787648879593, 1.5560141766956836,
        -0.037039417521638966, -1.5578667717297374, -0.15174825264689498,
        -0.0075908588231686416, -0.1347910987366526, 0.7535559035800633,
        2.9519825568174283, -0.8640992588734872, -0.486197602889753,
        -0.029079605859607876, 0.1393557947212105, -0.03201203543340934,
        -0.17255788414719309, -0.6220837667998668, 0.10441375911567917,
        0.7019930428559267, 1.822960884928266, 0.0010256621400676815
      ],
      [
        0.00030922277578629, 0.881375055029912, 0.881375055029912,
        0.8813750550299119, 0.9803845151714838, 0.9803845151714838,
        1.201629973822729, 1.2441077564052723, 1.8660677974280824,
        1.8660677974280824, 2.651002314516478, 2.651002314516478,
        3.233637461790533, 4.36384995486056, 4.36384995486056,
        4.975714528653046, 4.975714528653046, 6.591840750700408,
        6.591840750700408, 8.234009055219385, 8.238223602720305,
        8.238223602720305, 8.238223602720305, 8.903406631369169,
        8.903406631369169, 8.903406631369169, 9.126449234760914,
        9.126449234760914, 9.441918167657187, 9.441918167657187,
        0.4384156956352651, -0.017407483354635628, -0.13579407977759564,
        -0.08181457210659056, -0.5635031413839604, 0.570197125887921,
        -0.07389454022208618, 0.18950484918514415, 0.23442314823895152,
        0.5187197914643009, 0.03760777637611914, 1.2080522066616035,
        -0.006796933498365149, 0.7597395812711474, 0.3165595784185247,
        0.09234381717322694, -0.047116958459538144, 0.02161370846364295,
        -0.3330735946096464, -0.310519881157395, -0.1321730433969341,
        -0.32004747583182785, 0.38880240494533963, 0.5587916266845782,
        -0.04068226055752174, -0.04929253976644778, 0.7350044083650977,
        -0.3347542084226466, 0.07994172439872818, 0.177027499128215,
        -0.03555523462670161, 0.33584282142298794, -0.06474358479167515,
        -0.23271669416276414, 0.27707249457309313, -1.8841797053563085,
        -0.39250057722196113, 0.0604718224769807, -0.15658247224402194,
        1.097732135880844, -0.47958374693582667, -0.13884788062191106,
        1.2517060190766023, 0.08912037934357776, 1.8722824819152626,
        0.5767878477607333, 0.4375958673531614, 0.017187174100509652,
        -1.172587468420202, 0.736957937590481, -1.8818047463381875,
        -0.29954118659750983, -2.8240783717504883, -0.0009188056875444823,
        -0.014480253731157836, 0.8344869723837732, -0.235921407746533,
        -0.2726490308679638, -0.4874528967327087, 0.05731267695545898,
        0.32920686175801595, 0.0470036094807545, 0.6942117349751494,
        -0.24738597040458754, -0.3530344251488351, -0.7207866325012796,
        0.6865004571010461, -0.022934954570734595, -0.4703523591474931,
        0.00010065187353926284, -0.25737840979321513, -0.37927040299996573,
        0.3323512575736423, -0.7162822410895011, -0.8849129065134153,
        -0.02984860970928172, 0.9857401879405846, 0.13869536095324345,
        -0.4901093246549395, -0.15185390643388375, -1.1107951730061545,
        1.1255217267520845, -0.36113008327046914, 0.12498769155032201,
        1.105653484876161, -0.0826241142760939, -0.6079720837354008,
        -0.4798331114275297, -1.1230771992973987, 0.13634359721928585,
        -1.0117198549615587, 0.0420371772323395, 0.4704689604818435,
        -0.1136051809968673, -0.4158299646895606, 0.7682233881623428,
        -0.8567828943049521, -1.0844985071567337, 0.8118563616911731,
        -1.0011580890685694, 0.06773503500153778, -0.9972068257582826,
        0.22064841214728595, 1.015101892093672, -0.023903188302909387,
        -1.5448535965900865, 0.40727537812840897, 0.6273868528756265,
        -0.06403282214251436, 0.1402221940396834, 0.011807494022614938,
        0.19970219531306482, -0.3159297567283321, 0.5243897804672414,
        0.6302439365729751, 0.4184253509022523, 0.38422115408735924,
        0.8610939738936156, 0.3457693810952046, 0.19105880264763628
      ]
    ]

CONFIG_PATH = "exp.auto.yml"
STATIC_PREFIX = "AUTOMATE_xy_noisy_time_evo"  # Output file prefix
NUM_RUNS = 10  # or len(OPTIMIZED_PARAM)
RIC_MUL = False

# === HELPER FUNCTIONS ===

def set_output_prefix(config, index):
    """Set output filename prefix in the config for the given run index."""
    sample_tag = f"{STATIC_PREFIX}_sample#{index + 1}"
    config["output"]["file_name_prefix"] = sample_tag
    return sample_tag  # return it so we can use it to load output

def set_init_param(config, param):
    """Set the init_param value in the config."""
    config["init_param"]["value"] = param

def run_main():
    """Run the main.py script with the given config."""
    subprocess.run(["python", "main.py", CONFIG_PATH], check=True)

def load_output_json_by_prefix(prefix):
    """Load a single JSON output file by matching its filename prefix."""
    base_path = "output"
    if not os.path.isdir(base_path):
        print(f"[!] Directory '{base_path}' not found.")
        return None

    for root, _, files in os.walk(base_path):
        for file in files:
            if file.endswith(".json") and prefix in file:
                file_path = os.path.join(root, file)
                try:
                    with open(file_path, "r") as f:
                        data = json.load(f)
                        print(f"[+] Loaded {file_path}")
                        return data
                except Exception as e:
                    print(f"[!] Failed to load {file_path}: {e}")
                    return None

    print(f"[!] No output file found for prefix: {prefix}")
    return None


# === MAIN AUTOMATION LOOP ===

def main():
    for i in range(NUM_RUNS):
        print(f"\n=== Running redundant + zne iteration {i + 1}/{NUM_RUNS} ===")

        # REDUNDANT RUN
        with open(CONFIG_PATH, "r") as f:
            config = yaml.safe_load(f)

        config["run"] = "redundant"
        prefix = set_output_prefix(config, i)
        set_init_param(config, OPTIMIZED_PARAM[i])
        config["zne"]["data_points"] = None

        with open(CONFIG_PATH, "w") as f:
            yaml.dump(config, f, sort_keys=False)

        run_main()

        # LOAD OUTPUT JSON
        data = load_output_json_by_prefix(prefix)
        if data is None:
            print(f"[!] Skipping zne for sample#{i + 1} due to missing redundant output.")
            continue

        # ZNE RUN
        optimized_param = data["config"]["init_param"]["value"]
        data_points = data["output"].get("data_points", None)

        print(f"Data points from output sample#{i+1}: {data_points}")

        with open(CONFIG_PATH, "r") as f:
            config = yaml.safe_load(f)

        config["run"] = "zne"
        if not RIC_MUL:
            config["zne"]["data_points"] = data_points
        else:
          cleaned_data_points = [row[:2] + row[4:] for row in data_points]
          config["zne"]["data_points"] = cleaned_data_points

        
        set_output_prefix(config, i)  # same prefix
        set_init_param(config, optimized_param)

        with open(CONFIG_PATH, "w") as f:
            yaml.dump(config, f, sort_keys=False)

        run_main()


if __name__ == "__main__":
    main()
