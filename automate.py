"""
Automation for redundant and ZNE runs.
"""

import os
import yaml
import json
import subprocess

# === CONFIGURATION ===
OPTIMIZED_PARAM = [
      [
        0.43940602753254654, 0.4524980474487914, 0.6462847510297367,
        0.6535145711164267, 0.7019965052930044, 1.0830061860275473,
        1.4380021973026182, 2.1860837771467474, 2.1860837771467474,
        2.1860837771467474, 2.4875804812430995, 2.911818356328843,
        4.9134595358452735, 5.043089843653786, 5.994354774193697,
        6.658321281734746, 6.666230857319696, 8.458454027735183,
        8.458454027735183, 8.458454027735183, 8.938931772570164,
        8.938931772570164, 9.876451730548837, 9.876451730548837,
        10.140618079102744, 10.453495471248813, 10.878653713196195,
        11.282429749250388, 11.726474998572407, 11.93229290545428,
        2.9640535214497064, -0.6206168106317247, -0.4035747848788786,
        -2.067222048924027, 2.0576259596946604, 1.364315765000901,
        -0.1480698866383175, -1.95043906046908, 0.7897528850889669,
        1.350582507885341, -0.3349044763190947, -2.3429833820345465,
        2.04351680973891, 0.8083219796841106, -0.06520770630024467,
        -0.8776318722364843, 2.4862506381076748, 0.8345121096737285,
        -0.03071661620417745, -0.6225183255138825, 0.7450777062518694,
        0.12619297185303674, 0.15620862918286052, -0.47540100870445906,
        0.6345315438244892, 1.451076347224231, 0.10985833383721234,
        -1.6475696409761669, 1.1918822544398533, 1.3235539868194213,
        -0.24222060474147966, 0.2418944215339802, 1.0397651583041008,
        1.6773252160624976, 0.16975786500059598, -0.9211027317156172,
        0.7590471244619662, 1.76540125315151, 2.43856734239768,
        -0.19488067618654012, 0.8462629124439717, 0.9979674075340036,
        2.5775834810620677, 0.5650956422366618, -0.5475934153287456,
        -0.0253449469292375, 1.2524069066350432, -0.605696708865831,
        0.7019502861337156, 0.2803153244338447, -1.0831925759777479,
        1.0082140101851143, -0.3762046176346905, -0.9535933533256993,
        -1.0422804614435257, 0.13948594332192887, 0.5835070530053111,
        0.16086524965091817, 0.06403444071667018, -0.06194188553710435,
        -0.4026223625881385, 0.2750028468648149, 0.6789909068622377,
        0.05162849323802493, -0.7735332926339995, -0.14862918062202837,
        0.7661757453229759, -0.16119730427373616, 0.6482389226852195,
        3.1459456036848104, -0.4760920139337192, 1.6197254159790668,
        -0.5506328506738539, 0.9968299487743895, -0.3106735286083523,
        -1.2388662013594425, 0.8898580979157581, 0.43256773745092003,
        -0.7272220041247079, 0.8716071923554094, 1.5193589139179793,
        0.9787540447681606, -1.4044929205930872, -0.1984876316951887,
        -0.46744984056178585, -0.7765225748074835, 0.04344696088727837,
        0.32373965212791267, 0.9049555024172572, 0.7139278873651953,
        -0.8122282267372439, 0.5323405298774778, -0.08437719753251166,
        -0.14277007957413837, 0.7912147308716768, 0.26055493673650715,
        0.11357082745857092, 0.3153698930365579, 3.1981441448638614,
        0.32109035951393206, -0.23017443442945684, 0.0316864124540797,
        0.20875812581978664, 0.5466872162452653, 1.2918521189433907,
        -0.7312547980705957, 1.4958457475939604, -0.053193686203739404,
        -0.4437772137226961, -0.5271126400646005, 2.5136810835026426,
        0.6674244883024821, -1.0140291771816496, -1.177197116527103,
        2.058315434744553, 0.050372102721390984, -0.09022974351195023,
        -2.296438941834702, 0.3261688389091777, 0.3072223897800251
      ],
      [
        0.05238332857976487, 0.05238332857976488, 0.05238332857976461,
        0.5882470284735626, 1.6186245942059996, 2.2470777294271223,
        2.8315596913723913, 2.8315596913723913, 2.8333251330604914,
        3.7474015252366555, 3.7474015252366555, 3.7474015252366555,
        3.7474015252366555, 4.452994588443841, 4.625910007504636,
        4.625910007504636, 5.314362007876739, 7.185299991262795,
        7.185299991262795, 8.165312898322489, 8.165312898322489,
        8.165312898322489, 8.684979613482101, 9.661121823219345,
        9.674169964387936, 10.525655511340814, 10.525655511340814,
        10.525655511340814, 11.154963299169733, 11.154963299169733,
        2.50282655917642, 0.9490947670548783, 0.70056532212722,
        -0.9370006834105179, 2.127395945212884, 1.5529950009292526,
        -0.5538339242405286, -0.45109357069990613, 3.2608593101153462,
        2.1691098922881027, 0.924351518772188, 0.7799372105219657,
        2.588492585292434, 1.4914484649202893, 0.5111989894903198,
        -1.6854828839595362, 0.709524102178921, -0.3201993643863164,
        0.37756499567776974, 0.11160463007405702, 1.4506751210554825,
        -0.1158349928449886, -0.4172082421780774, -0.47420587439641587,
        2.1318004152619214, 1.5026342770773617, 0.9629412747697549,
        -1.017935070811068, 2.2274033566257083, 0.9541631607884562,
        2.2865374842341715, -0.6901760390806929, 1.4488496207691695,
        -0.15529093800821045, 1.378510821815928, -0.1238908488185843,
        1.0420944500710088, 1.8938950235205334, -0.40270933293735856,
        -0.4838468076888962, -0.7769068081513464, 2.0570355933263196,
        0.33843722154840217, -0.21296684820549192, -0.3087457919151385,
        1.6713665097762895, 0.7955513549984788, -0.5031484152839188,
        0.2783608989762586, 1.4322280472670237, 0.12038812465567636,
        0.8648150791824706, 0.13552183280667268, 0.07182610915111512,
        0.3477791234991623, -0.1584859230597403, 0.5851519083687279,
        0.578565105996425, -1.7921034519484391, 0.9189192684840749,
        -0.6139572052593133, -0.023527142002935514, -0.6495330854871428,
        0.7767670181361933, 0.13616638059771954, -0.22568119775616352,
        0.4192866974084779, 0.1401009023541104, 1.419355971488301,
        1.1103093112149183, -0.8728413553259085, 1.014691351510677,
        2.35757700845783, 1.131891326153365, -1.2979835358031357,
        0.42365777146015526, 1.0982786992551208, 1.698510255572029,
        1.2090506157632, -1.3597097700308411, -0.9049577551064396,
        1.0199036275847497, 2.9541844671388584, -0.42829772740772204,
        0.6542829736223691, 3.7916586259391143, -0.1983670801457003,
        0.7855289833525587, -0.1534574040841844, 1.809122493112309,
        0.35293394466185096, 1.0573849517470935, 2.461665111905985,
        1.0784030177718114, -1.585709677044719, 0.8985620342798133,
        2.2360691692951646, 0.24022620726925167, 2.6922129347449117,
        0.15599094623602128, 2.799936411115923, 0.9657316063780467,
        -0.2732772147086647, -1.448572189075712, -0.7280589250410919,
        0.057973620624421296, 0.9321748335747359, -1.4338621772181848,
        1.3976338029473028, -0.25504403617708243, 3.210257057781798,
        0.03448775329128267, 0.05070056715723011, -1.3727823101385919,
        0.8243579770218447, 0.13142013414460954, -0.4933237632531999,
        1.1105137227416793, 0.7155364379215329, -0.21063252058278284
      ],
      [
        0.6189603325174557, 0.7142372255934472, 0.818217611349809,
        1.1433975540074377, 1.9121137997887092, 1.912113799788709,
        1.9189666863881127, 2.194219841514053, 2.734492156740232,
        4.250258815642276, 4.250258815642276, 5.774076859791501,
        6.527612880112256, 6.532834731882501, 8.049613322901676,
        8.049613322901676, 8.050730377555883, 8.561643142317116,
        8.561643142317116, 8.758357012835646, 8.758357012835646,
        8.78353884989931, 9.477076383056275, 9.536600626467342,
        9.536600626467342, 9.536600626467342, 10.241295505019522,
        10.318321333031077, 10.579129354925781, 10.82886994059623,
        3.662494394083504, 0.08309129295248968, 1.5295376506525808,
        -1.5964000102221196, 1.8988970610647178, -0.07218621526676876,
        0.7238532160702689, -1.2917423920622229, 1.8532222971765195,
        -0.40818119715800666, 0.469598065996274, -1.2652675561295137,
        0.41465882817859046, 0.48683539382624846, -0.15336518315146752,
        -1.6419783820068856, 1.2136622236743368, 0.5933123377118196,
        0.9666225223219593, 0.9539776194708611, -0.3793986531891993,
        -0.2570964298405315, 1.5884302353807402, 0.19867970725527498,
        1.0036205245072367, -1.7266220384949087, 0.6519864384701275,
        0.173373648086925, 1.8697046853700252, 0.5263944462203128,
        2.9785129063723943, -0.5937256494260224, 0.22753174799850245,
        0.24918335157216837, 1.5438671949833176, -0.2981477150404249,
        -0.0503664733834821, 0.542442835193611, 1.8096859498837612,
        -2.2260935596321993, 0.28693396030012636, 0.9986781622414097,
        -0.01940263773226835, -1.8805315707929653, -0.1513202473661221,
        0.1836836320118686, -0.5655439481125303, -0.30323205019871646,
        -0.4186198812206128, 0.2357002564872809, 2.8296979465953833,
        -1.0776781071762758, -0.08378558447273823, 1.7446476514004516,
        -0.4606832586075214, -1.762173446350097, 0.10241780783627007,
        1.6018254886002428, 0.2621004786967086, 1.349261138919249,
        0.14987623247602613, 0.5068543254371847, -1.3474781551208477,
        1.0890436270679893, 1.6662048029626129, 0.3608718991529565,
        -0.11137748070221386, 0.5641204379289552, 2.2546014997074266,
        1.8888740160956543, -0.23345107582518032, -1.5772444286238798,
        2.1408383357361265, -0.4968079560788485, 0.1533667959779154,
        -0.40238715350257875, 0.25591729793510365, 2.947382531044255,
        -0.32162602471486745, -0.7587223675916386, -0.8983111566200868,
        0.006114119281372181, 2.9372824954589514, 0.48288231335139287,
        0.7939297064609614, 1.9454360656955985, 2.092519500518508,
        0.8995449331251366, 0.10171517677156572, 0.45235144869603666,
        1.02501950409702, 0.24331156538914245, 0.48973195386607005,
        2.672871435464254, 1.313352678455905, 2.010046934709317,
        -0.42153209835304317, -0.13436700176919486, -0.6950305532982513,
        0.6026553555930264, 1.6681913778840949, 0.4125109526933123,
        0.514533549588801, 1.0794873063708696, -0.9571806916209341,
        0.27630815458061647, 0.6001387806934945, 0.5059087494947612,
        -0.5722342732268321, 0.3986919058890637, 1.0044202485382987,
        0.3352295947729849, 1.3777059541173544, -2.835684252944388,
        0.6104690716589696, 1.838086538234438, -0.3106134411398272,
        -2.2167272073692903, 0.10706372359431235, -0.17469850626418476
      ],
      [
        -2.397634216504411e-17, 1.429450133825379e-17, 0.9192297980258759,
        0.9192297980258759, 2.8984599305110854, 3.1993874679766523,
        3.199387467976652, 3.715279848679994, 3.715919998165357,
        5.126008182976459, 5.749875525815113, 5.785995839176617,
        5.785995839176617, 5.785995839176617, 5.785995839176617,
        6.315437962379428, 6.678845841951143, 7.3578167224936415,
        7.415694801781823, 7.531263738212295, 7.949087697575632,
        7.949087697575632, 8.111169110068786, 9.407094598577077,
        9.495286031274873, 9.495286031274873, 10.993257661103009,
        11.063439993331317, 11.639888600691357, 11.75175692668691,
        2.1152038588685538, -0.7839988468841306, -1.0579861702584952,
        -0.5122509123294313, 1.0012369417099964, 0.9275037440003397,
        0.5343037326701707, -0.014459274586663672, 2.31692048955396,
        2.1400689678453872, -0.9468421716760329, 1.3225342455296385,
        2.4229762260600483, 1.4561600175543838, -0.4592924007287594,
        0.6389204073366491, 0.5578650700802136, 1.458345504678432,
        -0.11931303728638508, 0.04406428844113783, -0.26144087074192934,
        0.6459890964472403, 1.2243061606997268, 0.09770103868863204,
        0.23645607828472368, 0.3280111145811677, 0.5390648705936556,
        -0.6034481934191781, -1.1942560416831098, 0.3295059316644399,
        -0.0732996553139216, 0.5043071925129845, 0.7399437462813884,
        0.3595686242698361, 1.4643835231854074, -0.1697776944282527,
        0.2588380732750666, 0.44311592273109757, -0.6031987466514527,
        -0.06131410155451245, -0.3299395710828798, -0.45492250592824107,
        0.5555861976799495, 1.1612177689175078, 1.833550163228831,
        1.5629483318007886, -0.2455585474033218, -0.4534768786824923,
        -1.2225865843307935, 0.20468879325769473, 1.3398561861341207,
        -0.58709602862573, 0.07181500566168061, 0.17010271339345,
        0.36406988692952136, -1.689809967880289, -1.1677426672173294,
        -0.7977758879892671, 0.531032719362766, -1.7722607960867016,
        0.6332033998224597, 0.6669814362912183, 0.218182728116887,
        1.0415656581640258, -1.4544893086294475, 0.5175174925258392,
        -0.9742907090362619, -0.30648595673224416, 1.2400541074634985,
        -0.30003161306087445, -0.14406503395842435, -0.43061285539013316,
        0.6914697219419143, -0.48545379734819916, -0.2166375004086177,
        1.2014709434123243, 1.0734635496959384, 0.43666289070672293,
        -0.9550440807047608, 1.2817732673505913, 0.6254203972471953,
        0.8730111716749767, 1.1814458389257443, -0.5855214911540807,
        0.33647224367417283, 0.914891547403245, -0.10924028322724566,
        0.6731472714644756, -0.8672547313943412, -1.1628903969680444,
        1.2968110405185924, -0.7478342770444015, 1.0157432273471354,
        0.05866260951598884, 0.1549884083832883, 2.402954000164725,
        -0.8510405490988947, -0.13394876321797194, 0.35128800256256376,
        0.03985349181110424, 1.0891408951797659, 0.49683980443602116,
        1.3618410332836905, 0.31089249400158553, 0.007823999182329802,
        -1.0325531315281817, -0.13635517978577905, -0.4783006843261583,
        -0.9648987725589863, -0.4094326055257113, 0.0620151507481985,
        -0.3631850012398663, -0.9119123598789223, -0.3458539889181142,
        0.8501459643039054, 1.6461875633189593, 0.08799287143090098,
        -0.82318299513447, 1.17289644669955, -0.9455811832961388
      ],
      [
        0.12420123662801165, 0.138246244841176, 0.34185010800102933,
        0.8771280515547424, 0.8771280515547423, 1.9326762312100456,
        1.9326762312100456, 2.879806034127527, 3.4467495190209787,
        3.460588109395402, 3.4605881093954016, 3.4605881093954016,
        3.911934955717517, 3.9564836804547703, 4.188240551814426,
        5.098640553346409, 5.098640553346409, 5.098640553346408,
        6.466332587579958, 7.457565848827182, 7.712724508543908,
        7.890302861063261, 7.898577524812402, 8.020037295803547,
        8.020037295803547, 9.289723192898348, 9.68251578824504,
        9.68251578824504, 10.66694519433398, 11.464898013549973,
        1.8095532965205083, -1.6633278493215808, -1.2281091611401596,
        -0.40155726479865544, 1.7903243850816337, 0.18661159996017582,
        1.2217850039169107, -0.48128156078104645, 1.438546033666569,
        -0.9466383819139143, -0.2179227006066069, -0.07921201994836616,
        0.6692914930417907, -0.16791294486623565, -0.3278463005181308,
        1.2883193159418245, 1.9001761172388045, 0.7646920019853412,
        -0.6325477821570596, -0.5987552945744136, 0.5669730115381587,
        0.5983941343774113, -0.06179171362000896, -0.6867235859693906,
        0.5211737756628548, -0.19354588250953578, 0.6072816218147872,
        0.3472677197742769, -0.08031734075212016, 1.4024126217748347,
        -0.5867181790012919, 0.809620813948269, 0.35997425529443994,
        -0.8722967249300235, -0.5874818244923429, -0.5567926036837068,
        -0.6652314874983639, -0.6042054992483096, -0.13918430829641074,
        -0.08277488470584692, -0.4972293169762719, -0.4421668735352916,
        0.6160601456858428, -1.1972657609969646, -1.1558488364748807,
        -1.4501782622641872, 0.03989088007781949, -0.8684923327267209,
        -0.5569704341339503, 0.15823054121075, 0.6345578215095505,
        0.3601853745371903, -0.42594808878819745, 0.08979804115834313,
        -0.153043281560756, -0.603228229875778, -1.1264410002736531,
        0.6895580235946861, -0.11045941959152497, 0.5174109375139814,
        1.3269460586908306, -0.3852298542423827, -2.4120095755015893,
        0.08807412161753436, 0.1228551365077638, -0.6982591234727157,
        -1.1618488040328845, 2.5586909942385017, -0.24921574033555105,
        -1.9870969070050777, -1.0279498295884981, -0.7796802357622239,
        0.48428681889730063, 0.7162815161060118, -0.15547297036103372,
        1.0522591887013215, 1.772822944479854, -0.2654037211186137,
        -0.2720110866721671, -0.03929478442656517, 0.34606077605631835,
        0.5533331494282367, 1.0574846609095763, -0.5747611578732846,
        0.4916772893793279, 0.9875709691916216, -0.17857479553023695,
        -1.147281220275154, 0.37370382177065037, 2.456815155407461,
        0.6567596591037266, 0.9507316292553318, 1.5113928877114242,
        1.8380989093110256, -0.1736919900840187, -1.2666253947041328,
        -0.554819304070435, 1.1931643666366285, 0.4614862178419797,
        1.2040726557184918, 0.3083618234293392, -0.4066692475369416,
        0.3740368412278018, -1.684611974494111, -0.8650016725760176,
        -1.4838330341878547, -0.14344887350922086, 4.203596189627334,
        1.1133202614474196, 1.391124117957397, 1.8627332105499828,
        -0.28192336755973296, -1.5416482647725873, -1.9612892990030817,
        0.8836928087418303, 0.300761821046295, 0.6785848024508535,
        -0.5500277556546446, 0.5742776326882599, -1.181756808209963
      ],
      [
        0.38848003251483587, 0.3884800325148359, 1.2841735835398218,
        1.284173583539822, 1.2841735835398218, 1.818138220668234,
        1.818138220668234, 2.7575469841005327, 2.7575469841005327,
        2.7575469841005327, 3.0053468968599275, 3.0053468968599275,
        3.005346896859927, 4.184079661691832, 4.83635165164968,
        4.83635165164968, 5.97926077140412, 6.458805266455043,
        6.513102391504654, 6.513102391504654, 7.122105903846713,
        7.2188422331450415, 7.988590448127284, 8.268095077127937,
        8.268095077127937, 9.164456488648115, 9.164456488648115,
        9.782953992889732, 9.782953992889732, 10.467486029517685,
        1.5496959718296535, -1.0300437645832343, 0.425343365508412,
        -1.7136674729251273, 0.33645197441382346, 0.2288357961575219,
        0.10470230685228102, -0.6612661793744108, 0.11823315872480306,
        0.48571962162230753, -1.3748501535311368, 0.2563120795974374,
        -0.38871520150353267, -0.18786175076151226, 1.0017996241286973,
        0.05598903629217323, 1.501328526357405, -0.32299727271195017,
        0.5715295079657807, -0.12201961934486968, 2.2747823054657927,
        0.16289086097520028, 0.027619518366160244, -0.10165606616500937,
        -0.06321979816820887, -0.27543819802246033, -0.0048370064103128475,
        0.1330138167350915, -0.06428151371988705, 0.21905201010909556,
        0.25697175483980955, -1.462905966720411, 0.8014511304369155,
        3.456137165485204, -0.3560002683832885, -0.4886877133354182,
        0.32039145066707037, 1.6153352350920127, 0.5940099487759896,
        0.18140087044059483, 0.27123106498617, 0.7444341922951362,
        0.170480557625751, -0.4688462519246396, 0.5235839184929864,
        -0.5470964469389679, -0.011921500492307424, 1.4116230981753706,
        0.49972453659747124, -0.7800673920851233, 0.4234227404504273,
        -0.2071635265929523, 0.14064328933496192, -1.2007096247825992,
        0.12047098237640114, -0.4125103841815656, 1.0447620953563077,
        0.0020814149928196773, 0.4988991062112368, -0.34495773827123155,
        -0.12849063482979717, 0.4280934542561602, 0.7138444629946918,
        -0.6497712710787925, -0.43652659674625793, 0.917432486791049,
        -0.8523477361785018, 0.5648987974980545, 0.3183226113969618,
        0.14295784675778261, 0.9589824340171335, 0.9194478619356266,
        1.1001359353915339, 1.5417377267389083, -0.5376003771957187,
        -0.5404528215706331, 0.21624687748210675, 0.8814937279455825,
        -0.371639532103812, -0.2668100917972658, 1.3133163210428074,
        0.44574090697479807, -1.0940261852319737, -0.313830643067749,
        -0.06100275437545863, -0.049560783686653447, -0.3025056724120473,
        -0.9891529613817422, -0.35099332176432035, 0.5436069706516342,
        -0.722828417704955, 1.6968661444846564, -2.4402971962208975,
        0.7865745542588627, 1.3437881169309889, 0.36108471326554326,
        -0.1749159211919777, -0.014334278530919132, 0.02978377629472008,
        1.8533978555002608, -1.8470426695738211, 0.6272356375919823,
        0.44775499409400255, 1.3281153539688288, 0.4583217606753929,
        0.6443670392327268, 0.5254233581973354, 2.3087652110195127,
        -0.7761319091913014, -0.7605421959233766, -0.6461580464596497,
        0.7075597766411752, 0.985778508379752, -1.3130974173457381,
        2.8711331564400684, 1.2993543284582694, 1.9493614761217355,
        1.1647493000584068, -0.42731613935458074, 2.7038346000669766
      ],
      [
        -1.8784742854218807e-17, -7.763750530158576e-17, 0.3802827375258553,
        0.44096449652630626, 0.8040692975576897, 1.9224694434519336,
        1.9224694434519338, 1.9224694434519336, 1.9224694434519336,
        1.9224694434519336, 1.9224694434519338, 2.730288811725591,
        4.476350841356259, 4.476350841356259, 4.476350841356259,
        6.331658137341824, 6.331658137341824, 6.7621011201584285,
        6.77851096220289, 7.490043179529316, 7.490043179529316,
        7.490043179529316, 7.490043179529316, 7.511664240193972,
        8.302259372586072, 8.36899822047307, 8.607405767895836,
        9.631163052898822, 9.874876363637043, 10.225975825453373,
        2.711573403856553, 0.20239905137011172, -0.4220883549830381,
        -0.8404830976891227, 1.794332340210785, 1.5095243517856047,
        0.22326098118939897, 0.07733371735403745, 1.280548885023134,
        1.4121496210624682, 0.9815935680907694, -2.975348552150871,
        1.6316643284140941, 0.8239502945369961, 0.0314505340316768,
        -1.0892891749800817, 1.720694113273713, 0.6634696927679957,
        -0.836512780686814, -1.1286873737196692, -0.09500137106776224,
        1.0428135848317974, -0.4828772957450712, -1.129334172148368,
        0.7253737318795237, 1.4108675361353635, 0.7588540034470418,
        -0.5039485441412638, 0.10346857579652805, 1.2668095290766983,
        0.7994757345637048, -0.7393240316081237, -0.7818304990031031,
        0.25375980918776664, 2.228975199542585, 2.2487625387645873,
        0.6384105819815235, 0.39434544396871446, 1.3679129840939837,
        -0.27336699910726836, 1.3170761670781417, 1.1159622861844822,
        1.176824183488981, 0.40583799697229034, 0.8786168217534174,
        0.2914083315983707, -0.8464697846173548, -0.032455291822620566,
        -2.0755386823554396, -0.11439663923099666, 0.7312672791487281,
        0.4263196833485598, 0.11802610051350722, 1.0445881812565523,
        -1.9566462184988007, 0.9492303984073598, -1.7129593951518396,
        -0.3230601534209437, 0.3161713641922788, -0.4811213940350071,
        0.08327140785409295, 0.37526634808329173, -1.9990814349080968,
        -0.15397700748904192, -0.9549084255901845, 1.1120455683467105,
        -0.42952128451280097, 0.17929609797141985, 1.0446016069356951,
        0.846774755857218, -0.2784586201121851, 0.23000407229986752,
        -0.9198047598183884, 0.996529675185623, 0.34608382599103005,
        0.5099375110708237, 2.1948932092248885, 1.3625694142279887,
        -0.9306056124011278, 0.6012804875871011, -0.7788968212470156,
        -1.5884735532174328, 1.0361309111992296, 0.015937704739038126,
        1.4003797043998856, 2.429422654005534, -0.27504014116509645,
        0.8256449732433587, 1.2146087003914199, -0.6435553984602482,
        0.3046269503778821, 1.0182549333954134, 1.4202224852266074,
        1.3511302325707892, -0.7261672378416364, 1.5992752660640235,
        -0.5764295578986515, -0.8318409785507642, 1.1375736468462807,
        0.8529850561064739, 0.9553972898831558, -0.09161160854677679,
        1.617622889574723, 1.4551513261723394, -0.08817813881493969,
        0.8045852859105778, 1.9892741470924016, 1.8347816167556374,
        -0.8050652823779443, 0.008511392950551585, 2.1460096989270747,
        0.49277581514942953, -2.4311684786278165, 0.5134791015266132,
        0.9751974520662461, -0.38582649358518695, 0.7746227771853464,
        1.7307944301597258, 2.1320333699599043, 1.1654652968447545
      ],
      [
        0.4022850038273885, 0.4222288083135141, 0.7644599371513524,
        0.7900179023917507, 1.1026508993249646, 1.1630326759467198,
        1.1630326759467198, 1.2119340062926192, 1.9859325565890973,
        1.985932556589097, 2.096166401632718, 3.378647998605865,
        3.378647998605865, 3.378647998605865, 4.354848115861854,
        6.006218342726225, 6.006218342726225, 6.009974297352436,
        8.225327865566033, 8.242093148909708, 9.222354355246733,
        9.369468664000962, 9.432712219232048, 9.692289963799956,
        9.692829942577658, 10.391360826688166, 10.391360826688166,
        10.529867035412478, 10.529867035412478, 11.06290493838992,
        2.9062307172979733, -1.7788694936155562, -0.1145266982224492,
        -0.9311559923392093, 0.9691998209476543, 1.7463479137973288,
        -0.7663862807329105, -0.9694574896037749, 2.8979112386638413,
        1.1400097878698292, 0.8096361549155084, -1.5900494197653285,
        0.09829667109053167, 0.31839493135320834, 0.3886777840539921,
        0.12229184789371997, 1.7250225844898464, 1.0065795676456808,
        1.4535641205083867, -0.3486770669120958, 0.2556790893233589,
        1.778531141883236, 0.269972269049403, 1.0155903957099945,
        0.8041163886037216, 0.5381821926966456, -0.30108604163317454,
        0.6396533041678052, 2.1819991440037696, 1.4978086658278347,
        2.5181040929106753, 0.4624415671193703, -0.17701736987873673,
        0.6910098122382194, 2.947172461882987, -1.0727539032453073,
        0.4023854197196741, 1.650490750838525, 0.9313998963798695,
        -0.6769162055305248, -0.5620785927454173, -0.20885673940707247,
        2.5019757090972443, -0.37561416876024456, -0.9329392032282731,
        0.7818961506889994, 0.44350434198669075, -0.10644929099379355,
        -2.498928032568615, -1.2046085786256906, -0.06365416567297402,
        0.17257236645054272, 1.2516209341031546, -0.3591527663232026,
        0.46789807326225935, 0.24374638092155315, 0.02110383811013195,
        0.12714835746845662, -0.5505736947218767, -0.03497727012222505,
        -2.2168334497478877, -0.21485512988314215, 1.7552902914988067,
        0.6189795903733311, 0.3191491062237487, 0.522632432692797,
        -1.1121089236913335, 1.1371618962620422, -0.2410043783817164,
        0.24168543661014927, 0.39418565996934685, 1.2107667809264395,
        2.398781467533486, 0.6948257569073976, 0.6170229142231725,
        0.7050419245924102, 1.768546262611762, 1.5562956304120967,
        -0.4269237214365518, 0.6302835616447369, 1.7710848704009405,
        1.2281100264507194, 1.5036530549577243, -0.7435268012971183,
        0.7613541379199313, 0.8523298100708424, -0.6655959646469325,
        1.1543911681084875, 2.2675628634479494, 1.0299985170060308,
        1.400963430022522, 0.27759304330136975, 0.6960561589746208,
        -0.4210335016880339, 0.0336463669485127, -2.099660094290342,
        0.6674819238895001, 0.5049668435179431, 0.48001405045948287,
        1.3574871122533543, -2.2986993170736225, 9.601426007351498e-5,
        1.3312470798272018, 0.7582238004326416, -0.35033967277151296,
        -0.4108552112493075, 0.1982910129710702, 0.6700017270602091,
        0.26559360983179486, -0.14563210230012705, -0.39610135234418875,
        1.1727729846793147, 0.6713573564879365, 0.8527070052929181,
        0.8268283343075853, 2.2918575835381745, 0.5082103460913493,
        1.8600493489550152, 0.49576811175353974, 2.232387985311215
      ],
      [
        0.16477895719846114, 0.16477895719846108, 0.7183189156962347,
        1.8697093861419474, 2.105082615571597, 3.05308344502201,
        4.199393321043376, 4.199393321043376, 4.199393321043375,
        6.490210948425593, 6.4902109484255925, 6.490210948425593,
        6.4902109484255925, 6.4902109484255925, 6.490210948425593,
        6.882554174728105, 6.882554174728105, 6.882554174728105,
        6.882554174728104, 6.8877583035732775, 6.8877583035732775,
        6.8877583035732775, 8.21014824639056, 8.21014824639056,
        9.071469420716642, 9.120928605341893, 9.714944098401723,
        11.474131735950095, 11.474131735950095, 11.794551582273902,
        1.341188628911811, 1.6554894539990426, -2.1068974621953425,
        -1.4171475675653578, 0.33211669069513333, 0.11331792925356984,
        -1.3610911099963097, 0.46439741779020816, 0.9313501387866817,
        1.0938593094543279, -0.3591727738608774, -0.4732622270970327,
        1.6321598874818157, -0.2782091348514778, -1.0526781349295347,
        0.0708703831522549, 2.6982701224663113, -0.038867313655444914,
        -0.10508583152652556, -0.40759365792756236, 0.6284849004330764,
        0.5192751929971827, -1.6282040637266806, 0.0014422433007245106,
        -1.8299719264591412, 2.3182597876656823, 0.8875167319646391,
        1.5664268415036142, 1.5052778791259855, 2.935955436800565,
        1.533101581959507, 1.8091829332960188, 0.45080966818917967,
        0.1506883627647002, -0.6843548866459184, -0.5544883854492364,
        1.2466562002431278, -1.1866110136199353, 1.4521358231995756,
        -1.125608676420736, -0.24054383618816966, -0.058272145415006006,
        0.410408128597049, -1.6441753460137252, 0.4019816715685168,
        0.4588365987304068, 1.354346078964423, -1.7153251360741875,
        -1.1039978646265602e-6, 0.7940670488104785, 0.17979772520560053,
        -0.24385394325110826, 0.6367160741723578, 0.8500459957371875,
        0.0559416907316065, 0.32418668587130467, -1.4797636873635434,
        0.11902177942387202, 0.5185165439317966, -0.08399222686641401,
        0.8650918037299421, 1.4911587670088011, 0.12792248933645675,
        0.3372262149750348, -0.6553154954729696, 1.1995792367396254,
        0.5132294030998703, 0.44835115860783636, -0.37116980512777586,
        0.7805194563374558, -0.854334789795377, 0.5008527672922033,
        -0.2302685629030402, 0.6145182391921147, -0.6575500079215796,
        0.8657035637529482, 1.1874516653159721, -0.16284802367068918,
        -0.26462171656665856, -0.9815102056659819, 0.23198397744948207,
        -1.087097195512072, 0.6616385654966559, -0.2929637257774683,
        0.03471390505932934, 0.2048751570049573, 0.9170017118070749,
        0.39617956766989404, 0.12006199846995962, 0.1922705913940127,
        0.8784478594386566, 0.055479957240883566, -0.6634105431569992,
        1.0742951419164057, -0.37818200958777604, 0.28548758229245597,
        -0.6594827056613419, 1.0235832498557866, -0.19428253177041227,
        -0.5531991468121416, -1.189626464718852, 0.2519110119226656,
        -0.6708462316627377, 2.7994352657547057, -3.8764436680175813,
        0.5152327138619494, -0.3749347648847944, 2.9042167722097862,
        1.1265965037549552, -1.850959186134046, 2.165374611027145,
        0.8818414791702859, 1.5039524911129019, 0.06564767423285973,
        0.6486215314149069, -0.08854143781823305, 1.8396223528529987,
        -0.00792246728000446, 2.8805879469479487, 3.6337353861266473
      ],
      [
        0.11853625011402234, 0.11853625011402236, 1.1173235551611367,
        1.7342580765110573, 1.7342580765110573, 2.108144483620023,
        3.054129947242328, 3.054129947242328, 3.054129947242328,
        3.056306360633301, 4.638414750363569, 5.0621851887275495,
        5.7503913724004905, 5.774998407238176, 6.917933224474368,
        6.917933224474368, 8.061549209526286, 8.061549209526286,
        8.061549209526286, 8.591251503132888, 8.591251503132888,
        9.051235537435975, 9.081856762230144, 9.467876152039107,
        9.545932016874406, 9.591419209848118, 10.465616352275608,
        10.465616352275608, 10.465735173309618, 10.980942228105905,
        2.0734674059611633, 0.32892201175743896, -0.007356440825095051,
        0.7856576253246221, 2.089457548986907, 0.7744884921126718,
        -0.35049309306395837, -0.6556831494452968, 2.0369525201874903,
        0.4739652080570001, -0.8564345639983049, 1.25716179603495,
        1.7181260437331554, 2.3978160665502384, 1.1152024575020885,
        -1.3335737674295711, 0.016650799076572978, 1.6607129762234538,
        0.648059834763191, 0.2438725527060928, -0.27307896000752346,
        1.4369017198677916, 3.5672448343800007, -0.5379702113035718,
        -0.7420664562717484, -0.529699891930992, 0.7301471483152846,
        0.781913925757813, 0.6004078048346045, 1.7324865479818374,
        0.4548236607944829, -1.4419813608219112, -0.684662976785234,
        0.8455512814500156, 1.97751114408285, -0.833202517811791,
        1.110524460863052, 2.6403320691876733, -0.3129427957408566,
        -0.06674204626492235, 0.5842857778318762, -0.21132485649138796,
        -0.011842019288790376, -0.25743970610802486, 0.7486616881233721,
        -0.1302029141156864, 0.09497091477412227, -0.3715265429351211,
        0.39570077921274605, 0.28643868832003017, 0.7848413456471106,
        -0.7157146817058562, 0.09411764456438232, -0.10910076647953601,
        1.1262761892344808, -0.27334997823872975, -0.44027652197942063,
        0.6740415100156434, -0.336256645457715, 0.4268157265313067,
        -0.8611696251566416, -0.34560928156726306, 0.5618074077714486,
        0.5866360379174992, 1.8662876827821717, 2.21592310898005,
        1.972223656383108, 1.6141187926643297, 0.856255815565121,
        -0.34275929095614754, -1.0642528745182613, -1.0618686751734654,
        0.2379582550153795, -0.6501770361983872, -0.19408645485522444,
        1.501330829125914, 1.5726602727591479, 0.7066066097903853,
        -1.4580936665368467, 0.46940440748349077, -0.1287015677341077,
        -0.9805925033056946, -0.3754741669636888, -0.026817919501009202,
        1.1067346586651607, 0.17547923725022047, 0.8902143171896091,
        -0.22777698610446503, 0.8082253583749343, -1.0674083601412958,
        -0.022706971436593337, 0.34227899244110566, 1.3527736523760083,
        2.0767841716125894, 0.5778568145668401, -0.6555502504392442,
        1.2670274746873995, 0.507694022232518, -0.2629991187543805,
        1.7048253080726326, 1.4088065522309612, 2.823918413203317,
        1.2763232744235296, -1.4348344213353486, -0.605496445996402,
        0.09645158262695042, 0.024639736182597342, 0.23997550724405606,
        0.9979895378690888, -0.40612123795993227, 1.826790650755685,
        0.029599395583551916, -0.4592861834683686, 0.0328358806035505,
        1.3612120706287358, 0.8210402794880411, 0.05688164146575431,
        0.03152531580318861, 2.0316547976974904, 2.795039607579165
      ]
    ]

CONFIG_PATH = "exp.yml"
STATIC_PREFIX = "AUTOMATE_heisenberg_noisefree_time_evo"  # Output file prefix
NUM_RUNS = 10  # or len(OPTIMIZED_PARAM)


# === HELPER FUNCTIONS ===

def set_output_prefix(config, index):
    """Set output filename prefix in the config for the given run index."""
    sample_tag = f"{STATIC_PREFIX}_sample#{index + 1}"
    config["output"]["file_name_prefix"] = sample_tag
    return sample_tag  # return it so we can use it to load output

def set_init_param(config, param):
    """Set the init_param value in the config."""
    config["init_param"]["value"] = param

def run_main():
    """Run the main.py script with the given config."""
    subprocess.run(["python", "main.py", CONFIG_PATH], check=True)

def load_output_json_by_prefix(prefix):
    """Load a single JSON output file by matching its filename prefix."""
    base_path = "output"
    if not os.path.isdir(base_path):
        print(f"[!] Directory '{base_path}' not found.")
        return None

    for root, _, files in os.walk(base_path):
        for file in files:
            if file.endswith(".json") and prefix in file:
                file_path = os.path.join(root, file)
                try:
                    with open(file_path, "r") as f:
                        data = json.load(f)
                        print(f"[+] Loaded {file_path}")
                        return data
                except Exception as e:
                    print(f"[!] Failed to load {file_path}: {e}")
                    return None

    print(f"[!] No output file found for prefix: {prefix}")
    return None


# === MAIN AUTOMATION LOOP ===

def main():
    for i in range(NUM_RUNS):
        print(f"\n=== Running redundant + zne iteration {i + 1}/{NUM_RUNS} ===")

        # REDUNDANT RUN
        with open(CONFIG_PATH, "r") as f:
            config = yaml.safe_load(f)

        config["run"] = "redundant"
        prefix = set_output_prefix(config, i)
        set_init_param(config, OPTIMIZED_PARAM[i])
        config["zne"]["data_points"] = None

        with open(CONFIG_PATH, "w") as f:
            yaml.dump(config, f, sort_keys=False)

        run_main()

        # LOAD OUTPUT JSON
        data = load_output_json_by_prefix(prefix)
        if data is None:
            print(f"[!] Skipping zne for sample#{i + 1} due to missing redundant output.")
            continue

        # ZNE RUN
        optimized_param = data["config"]["init_param"]["value"]
        data_points = data["output"].get("data_points", None)

        print(f"Data points from output sample#{i+1}: {data_points}")

        with open(CONFIG_PATH, "r") as f:
            config = yaml.safe_load(f)

        config["run"] = "zne"
        config["zne"]["data_points"] = data_points
        set_output_prefix(config, i)  # same prefix
        set_init_param(config, optimized_param)

        with open(CONFIG_PATH, "w") as f:
            yaml.dump(config, f, sort_keys=False)

        run_main()


if __name__ == "__main__":
    main()
