"""
Automation for redundant and ZNE runs.
"""

import os
import yaml
import json
import subprocess

# === CONFIGURATION ===
CONFIG_PATH = "exp.yml"
STATIC_PREFIX = "AUTOMATE_xy_noisefree_time_evo"  # Output file prefix
NUM_RUNS = 10  # or len(OPTIMIZED_PARAM)
OPTIMIZED_PARAM = [
      [
        0.5482907189468895, 0.6413620809492503, 0.6422482149552934,
        1.5892409709442974, 1.850708229814058, 1.850708229814058,
        1.8745552660050262, 2.400679867939261, 2.402212278134192,
        2.485190345183722, 2.485190345183722, 2.4851903451837223,
        2.488397493491329, 2.4883974934913287, 5.077476636438464,
        5.077476636438464, 5.732990197214016, 5.806868622878696,
        5.817834245705687, 6.166757373752113, 7.3114292874931905,
        7.311858449036949, 8.346734585466223, 8.350435170229554,
        8.354614694314481, 8.35659817980371, 8.356905245901928,
        9.313534396314816, 9.313534396314816, 10.443787047737276,
        -0.5971318801423705, -0.6830583120471296, 0.053446928626708114,
        -1.488251087277441, 0.7409998345617078, -0.020561007687691084,
        -0.47029189134787985, -0.9187802118512801, -0.07390570205801456,
        0.6091612085770479, 0.5696050095749661, -2.634874245900948,
        0.14733366015521565, 1.0781100436188797, 0.3459269460772517,
        1.2820636645787713, -1.605623121104658, 0.856791024529966,
        0.16374864437029604, -0.7377840957855112, 0.7603752030179747,
        0.4958590077418653, 1.0293890027768824, 0.4862585296205842,
        -1.0838654128292502, 1.2632637762941026, -1.1043454462318527,
        -0.7867654190654241, 0.8818217647037212, 1.0406267750063978,
        0.05770567519039498, -0.5922070722918433, -0.3271403288282926,
        0.5980786503295974, -0.02050375112330311, -0.9007241609880184,
        0.5239405469453117, 0.7601496703420288, -0.6449049942439851,
        1.7340858429103823, 0.10050113333288421, 0.3143347863780438,
        0.28408386490618526, -0.1222389867527315, -0.09502282329152913,
        -1.3004368662949968, 0.16856179320059875, 0.6790103402211991,
        0.3355977478652572, 0.0935957266804422, 0.42936820813464754,
        0.5148227650107633, 0.10764356588532305, -0.054251737808208085,
        0.06525040933822983, -0.21143245853075732, -1.5801988491404158,
        0.023513208971767067, 1.0921277689034055, -0.11501776583679489,
        -0.14182911234947893, 1.8716225858725093, -1.0747761250482988,
        -0.01873186129021693, 0.9952348515577564, 1.5589645169221944,
        2.4625123021717044, 1.5320934484141422, 0.6264578101560674,
        0.015802850908690148, 0.6559295719723718, 0.5030706883609005,
        0.010357532831659657, -0.6971755064049523, -1.334963536555068,
        0.05714132580252865, 0.9478292633237722, 1.541635767019547,
        -1.2357775558070643, 1.5753066317572375, 1.2206753513411082,
        -0.013882574638756213, 2.102115305768464, 0.6867648509985108,
        -1.0810617894892982, 0.608205793929093, -1.0701207529796843,
        -0.008804617073740417, 1.0802724219136723, 1.4472704941581649,
        -0.525983160453369, 0.10347757085774918, 0.07451664808136123,
        0.8113743025574697, -0.19830571509994802, 0.20760359505818776,
        -0.5709476706639499, 0.1791350390980861, -0.32061652775092425,
        -1.6382844876022806, 2.271046687924862, 0.09972766177435569,
        1.671157305178672, 1.0596955078067567, -0.7395801076185267,
        -0.8217251410877643, 1.2660358026872456, -0.149859182069558,
        1.7386861885389688, -0.003505497297480453, 0.677126408740769,
        -1.0541684899696007, 0.9437251450981726, 1.7354017388586316,
        -0.8022872949930118, 0.01881044769021433, -0.013699411839369284,
        1.5965466699123847, 0.4486397166383021, 1.5669137279484207
      ],
      [
        4.1837705414928806e-17, 1.1742327239243593, 1.1742327239243593,
        1.174232723924359, 1.3021435979041922, 1.3883521076730898,
        1.4901272631800928, 1.490127263180093, 1.490127263180093,
        2.542545188872923, 2.56739133991554, 2.677178516908646,
        5.624946341909109, 5.624946341909109, 5.63924283183031,
        5.672838193807689, 5.672838193807689, 5.672838193807689,
        5.672838193807689, 5.672838193807689, 5.672838193807689,
        5.805507018952099, 5.858678454346443, 7.374841183417447,
        7.374841183417447, 9.078346087689514, 9.17910617229311,
        9.185363997877552, 9.550522060955204, 9.715006087156702,
        0.5380723684568228, 0.20346632529178696, -0.28402043001150323,
        -0.013694659434132353, -0.8491217472851175, -0.13891219530245408,
        -0.7902948900320785, 0.02035105936303376, 0.35891510624171696,
        0.07011262472067725, 0.2571910630887441, 0.09727807922224965,
        -0.4253506785797692, -0.08201618636277365, -0.5629942371157008,
        0.4984357070329931, 0.22460606922422946, 0.6436861273901548,
        0.5581387866543217, 0.6438048424266741, 0.6625810608832491,
        -0.2877740698749285, 0.03400434270310955, 0.6598198228171638,
        0.15695492486622947, -0.23277712193728803, 0.3379436543817524,
        0.6679629986711755, 0.4913802101172593, -0.6543304626041586,
        1.2398324170787045, 0.10868488610295632, 0.4726806257545104,
        -1.0278416218016544, -0.5660236088762642, -0.06627186605932975,
        0.3527547117645279, 0.3944014355355292, 0.33709190475341266,
        0.16707772676088822, 0.29195080738380563, 1.0354529601392413,
        0.12500585138196232, -0.037178956773431956, 0.7823218278561086,
        -0.04464215343745706, -0.36923576305262273, -0.9863817864437636,
        0.039519076991602065, -0.35646400258617383, 0.04542480304419608,
        -0.46125271135496354, 0.40472620693719735, 0.7802480661953589,
        -0.6757172179201896, 0.6396142241310521, 0.2327897749192615,
        0.8954622299286413, 0.7158405805761733, 0.1382139633537826,
        1.0616928944303126, -0.6122315420380016, -0.6738539946512315,
        1.0433459792659807, 0.494526070112864, 0.20621322780405107,
        -0.05318175489586881, -0.11213659998229918, 0.32941262943060273,
        0.13931786347259914, -0.07640781308377202, 0.31450116184408605,
        0.3658109215963646, 0.04460349089074807, -0.12913310998017427,
        0.31890485610090735, -0.005491508360761248, 1.2692063073436923,
        -0.3006174703747285, -0.41404661321397057, -0.5199199797590206,
        0.44225909618051784, -0.4233007342169607, 0.7456354776212751,
        -0.32484988424610756, 0.9268151291603125, 0.8385591284905366,
        0.027219364270413358, -0.5520387125082392, 1.3757901840365965,
        0.02933419406725825, -0.2915193842748469, 0.33917094344303517,
        0.10828106345120646, -0.5650186064180197, -0.6041651963720519,
        -0.19230834783869816, 1.9848826966849449, 0.0632219631903188,
        0.04804551511145073, 0.47752350144148015, 1.3406847618100746,
        -1.3722262204383469, -1.0513455672656666, 0.7121308231347245,
        0.13278942055995957, 1.9758312031522887, 2.19648222646383,
        0.8936788375205645, 0.05510909660880629, -0.18765678539637448,
        0.45031205104496697, -0.6542716355161553, 0.5783583754336702,
        -0.18844184232604352, -1.5667303012058793, 0.36110899429768645,
        -0.275182998952267, 0.30367576290775045, -0.1532687178202341
      ],
      [
        -3.641081222961908e-17, 0.6149788059529836, 0.7190202634465676,
        1.227117923902744, 1.282995668258181, 1.320146784613617,
        1.320146784613617, 3.1464089486715623, 3.1464089486715623,
        5.021180125711677, 5.021180125711677, 5.021180125711677,
        6.703692809170789, 6.703692809170789, 7.791601108223033,
        7.8369202041803225, 7.951907692650894, 7.98389042115583,
        8.258376681022987, 8.258376681022987, 8.264818959972613,
        8.264818959972613, 8.264818959972613, 8.264818959972613,
        8.265620267330194, 8.265620267330194, 9.412842541483705,
        9.412842541483705, 10.502716174481437, 10.502716174481437,
        0.1665558361704551, 0.0766182276072886, -0.06331706305100791,
        0.03225035272845343, -0.2265177184784691, 0.6859734408919996,
        0.358399999202588, -0.31490649734707366, 0.03084506070978915,
        0.8141179515629021, -0.05751068028622007, 0.9013204998454583,
        -0.325467390457223, -0.16027539072229496, 0.19756436832536928,
        0.17875052394899651, 0.07441990946369173, -1.7121562848350094,
        0.5411900571694856, 0.025994665514066265, -1.0547594680221428,
        -0.3558195097906033, 0.2575282902752545, -0.32652811387218433,
        -0.17477771883072452, 0.05603758809983181, -0.31531793685177084,
        0.24953935818155465, -0.21945102528047247, 0.016201452486715968,
        -0.47139285875704856, 0.8354485366702803, 0.28783787212142514,
        -1.483190369052958, -0.05324490057492157, 0.00808064868141892,
        -1.3894868155533049, 0.07648399162880297, 0.28128388531065984,
        -0.8032486745370345, 0.9961277979922681, 0.7271807873997648,
        -0.2598267503182047, 0.058937213125893145, 1.4176939090014022,
        1.5623836495300838, -1.2281014386266311, 1.627596878633186,
        0.150437982354294, 0.017798034487339433, -0.2091243023446671,
        0.08776907917710067, 0.637527078885032, 1.2603122563899933,
        1.0910453886717337, 0.001707278941889729, -0.5366140699752073,
        -0.04457743756443993, 0.708269991966563, 1.6757260639955311,
        0.6610325406900899, -0.508228690084442, -0.5178693625521746,
        -0.2955589105377924, -0.47790822054112786, 0.31077598178920485,
        0.020632196003020267, 1.5538854336639996, 1.2816443511581943,
        -0.6926864187150775, 0.73698114320343, 0.3645818015611773,
        -0.2097443780477125, 0.1421287040679699, 0.052774836076248374,
        -0.7306191772967899, 1.107856618529218, 0.3743379513498811,
        1.2959169452837032, 0.8858564921663113, 0.03370518740548656,
        -1.0860983069970114, 1.2199055901240408, -1.0630806559423625,
        1.3748402618369016, 0.9943926078324806, 0.7116645059379805,
        -0.21098608064682703, 0.04581715611274856, -0.17117312830066983,
        1.2229557830916487, -1.6273428514067598, 1.8508927721454946,
        0.851693435560975, 1.0946646161197402, 0.43088380554694883,
        -0.6171985422875839, 1.6866137951313547, -0.2289359575496427,
        -0.09152362655526167, 1.6917359096449291, 0.22722692961233917,
        0.49434218233553445, 1.2228162165990006, -0.4070166799423108,
        0.00966082758630671, -0.3344922737632815, -1.0755692755599169,
        1.1846485271761396, -0.06070659712292082, 0.6384418838463358,
        -0.034216786122488324, -0.6519049362670448, -0.0019231105719348242,
        0.503764046349436, 0.5779702041064313, -0.8610978040126155,
        0.5832069567020347, 0.07954533618121334, 0.016329041774977193
      ],
      [
        0.2383708143795501, 0.8137820253985804, 1.0561141201801563,
        1.2070683478267785, 1.9518166906091101, 2.08301823027678,
        2.6774459967535513, 2.7270096866449576, 3.7369434259122447,
        3.7421546540398443, 4.458327272130387, 4.463102384700506,
        4.463102384700506, 4.482690585412051, 4.482694652744643,
        4.498978826283554, 6.3580266266370415, 7.886395999997723,
        7.886532810158634, 8.060529572035655, 8.06234783983503,
        8.127555772505229, 8.130166630032164, 8.42408407139234,
        8.433074307328475, 9.412401860498063, 9.420584174895616,
        9.429609653004679, 9.434851407347677, 11.283524698808058,
        0.19157417616433814, 0.42257952171340063, 0.3129095694283805,
        0.28360255750055535, -0.7229159635345903, 2.545731433831817,
        1.1687892956196542, 0.5222949375721274, 0.9482151911772319,
        0.28742832079435787, 1.1627391357840349, -0.27939056132165146,
        -0.07574334812551493, -0.529119211391362, -0.08653083237786212,
        0.042544229108731915, -0.09154582517805988, 0.2776265525620834,
        0.373637405241428, -0.666296500917012, -0.729825790392568,
        0.36164641825124294, 1.2066181407380305, 0.18327070025757417,
        2.2757552060408917, -0.004789158452516104, 0.49019439516235463,
        2.190622553796523, 0.6131206832540379, 1.0987721265230228,
        1.9413219378309259, 0.07975169469268534, 0.17531082109327745,
        0.01770145552231998, 0.22429808435825893, 1.1460098869067579,
        -0.25766861736092417, 0.4386465248337572, 0.7521614434169624,
        0.07039918338308593, -0.23913727928604284, 0.062497116873310714,
        0.27575365987954265, -0.8268952220573135, 0.8599765782432734,
        0.6958325703328606, -0.16792542378671177, -0.13186811496768225,
        0.17745018848846658, -0.13764108606901534, -0.34798347931108986,
        0.3901205214779397, -0.12832331396189006, 0.7623260417931323,
        -0.08745728181826747, 0.22448567111633413, 0.5103689813486589,
        0.020179740460913417, -0.4639048953982949, 1.8052783293547816,
        -0.06895296635033099, -0.46137869531525183, -0.7694587159951923,
        -0.1507074275764489, -3.159084078074864, 1.5556721360426484,
        0.9802025173412374, -1.5980562353917622, 0.9974678614222413,
        0.11965749551778265, -0.5964068365118492, 1.00912773091807,
        1.2674306548806673, 1.7418320010188646, -1.2223756485879664,
        -0.006270145144671745, 0.7863824204489233, -0.08410721186616651,
        0.13420385894759826, 0.6686584151585806, -0.7946689395347296,
        -1.448768973512125, -0.4158373205099576, -0.1003664997933048,
        0.5370971852976741, -0.013369261455621718, -1.2134070474127567,
        2.71822204346588, -0.8266087910498845, -0.04274152999618493,
        0.627725493238542, -0.10714625448592663, 1.4055199595750496,
        -0.08877591733311402, -0.6400618055168635, 0.27990653766167567,
        0.27230874688701184, 1.8329367216853043, 0.12128377229042309,
        0.03719209379786179, 0.7558193864298689, -0.027085062677120984,
        0.7947118159580207, -0.18810209431195668, 0.008294184744538372,
        -0.9110921816475059, 1.3065108206329406, 0.004810940817056788,
        1.4030602129547465, 0.03878633149748846, 0.29850504257680605,
        -0.9524583070906825, 0.10037229527914636, 0.4277056649647598,
        -2.2528322583674503, 0.030724614514628212, 0.8416350822543037,
        1.5579013461800135, 0.5696673724928452, -1.5352194543526818
      ],
      [
        0.3442332088020621, 0.7247295953616149, 0.7247295953616149,
        0.7610537291022658, 1.7162580174489597, 2.0119282772467635,
        2.0119282772467635, 3.369934702704019, 3.369934702704019,
        5.00211845115155, 5.212181786011135, 5.346566249705437,
        6.103091648910964, 6.103091648910964, 7.050711873868975,
        7.050711873868975, 7.492144583370162, 7.492144583370162,
        7.606105711064038, 7.606105711064038, 8.717193051662631,
        8.753101318062777, 8.877107151002964, 8.889590522678484,
        8.982812044989718, 8.982812044989718, 9.499874357008034,
        9.499874357008034, 9.659025604148875, 9.671110590806489,
        0.02814413440270558, 0.250593445582179, 0.17496868989230024,
        -0.19749991731592192, -0.5878125517240043, 1.1370895496823794,
        0.3339578948727643, 0.30833012680275795, 0.21147160367429677,
        0.5518340573364652, 0.9816766119937317, -1.3427949214182668,
        2.2864376119784486, 0.673664283367827, 0.4767745045632036,
        -0.47480445681581174, 0.05912449937800317, 0.9513757199218045,
        1.079093875588678, -0.4313388366547843, 0.43347513808131466,
        -0.3381632209207048, -0.42699598389932686, -1.1528003206699722,
        0.2505681368756031, 1.1900947118566725, -0.38260053073473543,
        -0.6405385159573362, 0.08926968472452403, -0.04834256297702397,
        1.603027736914297, -0.44672812120859223, -0.5759172165575565,
        1.25237714334681, 0.04254918814060746, -0.002429292667880943,
        0.47732275422632153, -0.10204026491637587, 0.02357869435971368,
        0.06910865492863566, -0.5942663805386644, 1.1629666490831163,
        0.28625726751699415, 0.4183193427753825, 0.33026699893767814,
        1.8860632823719743, -0.37929215782635534, 0.8251027249542411,
        -0.13937217921728381, -0.35829122981546885, -0.11830319301401378,
        -1.1307480811476716, -0.33746884247229475, 1.7161163093033744,
        -0.03517175574182253, -0.4044561448132672, -0.7301790593832838,
        -0.10496992427986328, -0.0377875273258637, 0.11576685707785253,
        -0.9348023198901909, 2.132577954045408, -0.47199808297503054,
        0.09642080758509694, -1.5590866370005203, 0.10045413530924742,
        -0.3215930726850239, -0.7020784722315541, 1.2376661808413174,
        0.5709879203761018, -0.820670510834149, 0.1634866307612446,
        0.06270250983710676, -0.03570422816362065, -0.5699745682010601,
        -0.26488761312159137, 1.795803611544861, -0.4017001375917998,
        -1.757541020399501, -0.05132347348943386, 0.8521664539464072,
        0.4812990598336637, -0.7041980923594973, 0.6941905718406797,
        1.5589556954504384, 1.9089912382579748, 0.4849438728523755,
        0.03939482159422182, -0.2564597588944596, -0.16675906759041134,
        2.5610800117093855, 0.9927310518963223, 1.3170410278463267,
        0.6281459286410694, -0.07878692694615999, 0.5865838795710373,
        0.4894408136056478, -0.043552207832595204, 0.8988064624972067,
        -0.35279792613941824, 1.5088457985023234, -0.32174328535909336,
        0.41978129355629945, 0.014567846908235548, -0.17446008524494477,
        0.35494980160059775, 1.44166715836895, 0.027787407199764528,
        -0.2573832607835415, 0.9605798444843694, -0.08907047543629609,
        -0.012116788408097524, 1.2676248549462201, -0.2512276837340942,
        0.7869834357157488, -2.3607393050467915, 0.1914341630047483,
        -1.0542342437530707, 0.8454261921281611, 0.02027118187750096
      ],
      [
        0.02240293444906766, 0.9863710197203618, 1.3708545038264748,
        1.3757718928414557, 1.7844795346244002, 2.029643659915566,
        2.029643659915566, 4.135298362317422, 4.181946654536538,
        4.392782597821499, 4.473609589126697, 4.474471668054438,
        4.475838923576404, 4.4785869343507265, 4.4785869343507265,
        5.467009291914798, 5.470281162008999, 5.840541346188122,
        5.842392372241278, 6.505508038171383, 6.505508038171383,
        7.536348099553183, 7.536348099553183, 9.63019412694799,
        9.63019412694799, 9.63019412694799, 9.63019412694799, 9.63019412694799,
        9.63019412694799, 9.63019412694799, 1.1150074339792337,
        -0.03535947987647509, 1.1918755403807781, -0.20191103850925227,
        -0.268362117189328, -0.3595192771004685, 1.2614204066704717,
        -2.9429228213034166, -1.054810371869961, 0.9594255841252335,
        -0.09538831740389547, 0.3965663197177072, -0.22182226409641906,
        -0.2653718580482209, 0.1686090968331403, 1.6516484362324146,
        -0.3049608013883917, 0.49165272629600476, 1.9061569916625292,
        1.241422732345657, -0.11527538328521378, -0.22895223610637053,
        -0.06124477487110871, 0.6193220715745159, 1.372932614853267,
        -1.1538384701543527, -0.1139440760455718, 0.16973094341798492,
        -0.5943234340378932, 0.21399932498003596, -0.18156105319883253,
        -1.0504702368491705, 0.7232808408606985, -0.018870518436612777,
        -0.29343981279013404, 0.30960592292227684, 0.13511542022922338,
        0.5096669954667911, -1.097576281455009, 0.12047585913747774,
        -0.5585503308065869, 1.2279608447421912, 1.3012401380411538,
        0.3769592231863052, -0.5692023175942067, -0.4567508363134565,
        -0.679549924864495, -0.24647993267323956, 0.6292567546169889,
        0.9587256267378846, 1.7268825428143277, 0.1413792259593793,
        0.6520451922983643, 0.6152471684019365, -1.1240317980448378,
        -0.9856730455453077, -1.2455074642265085, 0.2235091354354849,
        -0.8870861048674711, 0.5299724059178798, -0.21820971616414211,
        -0.09687180933262383, -0.9247884680119297, -0.4566833626656702,
        -0.4285291193052864, -0.6406026728496247, 0.9023578506051637,
        0.03748900229192909, 0.7551248935414285, -0.18980887545414976,
        -0.1497604267964229, -0.4253730408988226, -0.4157675203773789,
        1.677209169409502, 0.2126888490300174, -0.13481167544410624,
        -1.6951458494505263, -0.006476362637627559, -0.5490470525961781,
        0.3195499617454318, 1.077429849794694, 0.6725724542747005,
        -0.10235701747439804, -0.014129818782246995, 2.382406086835482,
        0.008866515589568993, 1.0282503794544984, -0.6899701634722577,
        0.3510134577654823, 0.6918405669356381, -0.08667968085870373,
        -0.0005005962237103964, 1.3805542469189591, 1.011514915181436,
        -0.4623191099783579, 1.397645255720587, -0.7813361449321683,
        -0.9940660424170442, -0.6570734018108508, 1.0171740600492052,
        0.14480072689925969, 1.157289980717297, 1.019472554492438,
        1.0029573776528096, -0.20406480565208354, -0.011076077177880707,
        -0.30566521016454584, -0.4775965459909992, -0.7158801142606765,
        1.5610067764386268, 1.5187465408730505, 0.21158961058436962,
        -0.38098352608767794, -0.046999172842648596, 0.5964180792256618,
        -0.6260168044949087, -0.7215592053840503, -0.5706802740378752,
        0.11995346168986934, 0.17053214926260635
      ],
      [
        0.003408343124459994, 0.0034083431244599804, 0.006710027629051694,
        0.2484817728699434, 1.1672656342280407, 1.167470260322433,
        3.1453440534904744, 3.166261678218574, 3.2843704266652405,
        4.089250903115526, 4.091989893807717, 4.091989893807717,
        5.181052167254873, 5.181052167254873, 5.184972473956635,
        5.585122024093685, 5.5990893229720795, 5.630355974178803,
        5.704160317443757, 8.658831571647385, 8.66505230970618,
        8.712765508205756, 8.712765508205756, 8.712765508205756,
        9.168875276976076, 9.176734348833309, 9.262471352200725,
        9.262471352200725, 10.578606537988184, 10.578606537988184,
        1.5905119084430799, 0.8691136234632737, 0.04907693052707525,
        -0.23336553986203207, 0.4284777328779486, 2.2866815267075147,
        0.1760352312050406, 0.27820168999860917, 2.067264415281462,
        0.5755331494929522, -0.06858856463703264, -0.7222667597755238,
        0.7750924366303688, -0.278304785792398, 0.5352624789798245,
        -1.1702690163303244, -0.012717570027659048, -0.07125250327360101,
        1.7927644689789062, 1.3752915621891346, -1.1981440291126808,
        -0.30737164793891514, 0.2657743539912098, 0.04156274567190095,
        1.1363043468044227, 0.059217925806269944, 0.7608352104096147,
        -0.1513784586666425, 0.025696061144845524, 0.861481321747562,
        -0.48544656000194114, -0.006033515622113467, 0.473431667961849,
        1.5469119181224316, 0.1871819193791605, 1.555475823471471,
        0.9001349633565042, -1.5961139272878428, -0.6749613217725859,
        -1.5596468027729833, 0.5296186936496604, -0.8549575199843406,
        1.7649719371938613, 1.5569889217595585, -0.9244334407213903,
        -1.5804326845781602, 0.3840271097002098, -0.8070678340768227,
        -0.48791686278645724, 0.13110829311357092, -2.023238766590243,
        -0.8997043584182223, 0.8435119798114825, 0.12108034013815198,
        -0.7013572315179941, 0.05813246571029178, -1.3645229029121433,
        -1.704441396215925, 0.6160899239086374, -1.6580292769388947,
        -1.550797918270104, -0.033040246679508146, -0.7595754539148374,
        0.6024045095197653, 0.446745843265138, 0.9717727329863253,
        -1.3190014690683383, -3.180952616822137, -0.47685451708111876,
        0.03958388950097112, -0.04894683660460036, -0.013869967587830365,
        0.9715551393376142, -0.2688733257646762, -1.7112803723577967,
        -0.06346862095088202, 1.2756440828431679, 0.4087049517265435,
        -0.4433737535464867, 0.07044159255576982, 0.877714241226598,
        -0.33059433004855665, -0.41683973817974146, -0.09123983383660174,
        1.153451542408442, 1.5381060924707182, 1.4432055127327397,
        0.7948381511053778, 0.12126271666707081, 0.3736422837955817,
        -0.06595460407520624, -0.1569219765005705, 1.4053035958769775,
        -0.3443177603686477, 0.14604377230684606, 0.733462484703497,
        1.2365404639754205, -0.020105376528163625, -0.09631958929266826,
        -0.16876809298151013, 0.42184799028013376, 0.8803036484986011,
        -0.4148292271104988, 0.011464734896518355, 1.0895788780475535,
        -0.006017115067308532, 0.6476481463328121, -0.4792828310008005,
        1.7145504838049759, 0.9300252591703124, 1.4147034805691376,
        -0.04601267898776636, -0.34579443398211707, 0.006107561937391137,
        2.7608588509789516, -2.470402787070412, -0.2193552778493498,
        -0.43636419827955597, 0.5036040054264609, -0.006776779992121664
      ],
      [
        0.5698358581496117, 1.0111463732621893, 1.116254023022104,
        1.116254023022104, 1.4543153683590362, 1.4543153683590362,
        1.551144943675129, 1.551144943675129, 2.3321866923810566,
        2.4857852178760083, 3.837593499897418, 3.837593499897418,
        3.837593499897418, 4.847467397840062, 5.03660309473088,
        5.176578602594472, 5.176578602594472, 5.214332760543968,
        6.547255537065404, 6.547255537065404, 7.083633091144979,
        7.083633091144979, 7.133204014188821, 7.133204014188821,
        7.133204014188821, 7.937225733864811, 8.370661235857398,
        8.62656679928389, 8.759707620277526, 9.424598849529344,
        0.24247733923543782, 0.79275118507479, -0.012314768690710378,
        1.2247395896468714, -0.6087890007814074, 0.9804698093938512,
        0.19554007335952167, -0.18291383394130525, -0.08254523307317092,
        0.18380200005144362, -0.06242013495608768, -0.18902966193120999,
        0.4846770511497838, 1.2162916157423216, 0.4476502570273604,
        -0.5204828708955642, 1.1525916637240337, 0.9814837501696517,
        1.2019836737296188, 0.10039944576408244, -1.165620769823409,
        0.5709783345435084, 0.04690539627488982, 0.3150855883896384,
        0.6835833386917337, 0.7350671828581666, 0.15105693185753874,
        0.7851129846448224, -0.290237804763004, 0.02628688844012564,
        -0.3427838784588314, -0.12202424723691215, 0.30368921729231485,
        -0.08398845633414893, -0.34421225485285395, -1.0992299599969957,
        -0.6679166311787512, -0.4925602784337871, -0.7607905356843834,
        -0.061822787578292515, -0.33643902903801526, 1.7237644621079549,
        1.1087838048318122, 1.4391293107545464, -0.2688865923867924,
        0.07238699078201241, -0.7262166431073663, -0.8607492696026928,
        0.1828620517189283, -1.5556021786529124, -0.5230641559705965,
        -0.023465829708141782, 0.5773817105800866, -0.6189512057198875,
        -0.1704298219551506, 0.6935490081871019, 0.43024761601627914,
        -1.3818053283072975, 0.32069867830077864, 0.11223505487625844,
        -0.6642209341325642, -0.7163563578386999, 0.9533459704680486,
        -2.5373567196844773, -0.3530595330204968, -0.36744271288254204,
        -0.4105700661159024, -0.529185988706723, -0.5074466275713505,
        0.5969687397167245, 0.1454479675984071, 0.9510340399481164,
        -0.16051754924491393, 0.168676911677473, 1.6243103666539225,
        -0.3533677275828062, 0.23248347317288842, 1.550100715213732,
        0.3540002793004863, 0.11004939052123668, 0.0026309322638186474,
        1.0023099891482978, 1.3075603782358884, 0.06614039249633322,
        0.12696883216368457, 0.4650745950568721, 0.09288306127511851,
        -0.05535633254466518, 1.0893487961438044, 0.1856572010619516,
        -0.3369565165204948, 1.1993442715596423, -0.1637322799431796,
        -0.05574034797393315, -0.6499132821077687, -1.1854402746414112,
        -0.20554021240749126, -0.697991352679575, 0.7715290435685477,
        0.27728540290360154, -0.7490020286422794, 0.6727458447445039,
        -1.3928966895283914, -1.1123692530480307, 1.2429888713160355,
        0.5002310144425463, 1.0425617895549082, -0.41250228671824735,
        -0.20782873770333182, 0.952256354944612, -0.2180059005687231,
        0.8024032545701543, -1.0975152466418368, 0.6192383355749876,
        -0.44420258004771784, -1.3605235580058401, 1.4196204597477091,
        -1.1230853758949062, 0.09475958663430169, 0.9412942473630452
      ],
      [
        0.17961742860022237, 0.4029745783400613, 0.4271020388774394,
        0.6998927493507625, 1.1444327445959492, 1.4463150894355827,
        1.7859669797147917, 1.7859669797147917, 1.8910076260348616,
        2.1568466639380097, 2.184715675260106, 2.3241261579565067,
        5.221288254664872, 5.360678146313719, 5.572749542622228,
        6.315664711217606, 6.332942041057151, 7.225695385348529,
        7.238714694082236, 7.767863290353532, 7.947954629935657,
        8.045079231148478, 8.080705184182557, 8.235317994608641,
        8.52967785406855, 8.920755162601605, 8.920755162601605,
        8.920755162601605, 9.75907480462672, 11.068402571583377,
        -0.07026370230905016, 1.2758275954101812, 0.1960569796315372,
        -0.7454998985427054, 0.5260870873255556, 1.3632265149428353,
        0.06759709485075166, 0.7201883678889174, 0.7780364770341424,
        0.7034018811814728, -0.3281225120527201, -0.21523884970562404,
        0.3525948786581971, 0.10058439953616755, 0.8489242437750127,
        0.4102210250930649, -1.1239274808373552, -0.07527028057729333,
        -0.662823747816413, -0.09016589559770041, 0.0005078927131911535,
        -0.9974030724775158, 1.2973260682530905, 0.6207513445119947,
        -0.06959715000945968, 0.01479447508324883, 0.5707366547040263,
        0.8024230791007029, 0.11580671533830131, 0.5319238260215059,
        2.029703693625361, 0.8476591202353092, -0.5985490132202251,
        -1.0850372047073247, -0.13885829158476937, 0.6160884575951602,
        -0.6119315652443118, 0.25456754270344084, 1.6135141314150674,
        1.6101080474118592, -1.0046888465114787, -1.2174288348798858,
        -0.8801790341822278, -0.01998793431745051, -1.007194981866689,
        -1.6365882266166358, 3.524880820008825, 1.5399950054830251,
        -1.401820445976074, -0.04945776017633801, 0.9565666812114323,
        -0.20490442564626934, -0.5632271134618189, 1.0033608730635488,
        0.12368927199762578, -0.06153617179775209, 1.0557374829951787,
        1.532632985657107, -0.3069192599686721, 1.8620498010178619,
        0.18083984306067874, -0.9702971127887235, -0.4866438529829019,
        0.2527358034573417, 0.46390718912935613, 0.05253485630073179,
        -0.15957905175444287, 0.5064463362180326, 0.6588516997606392,
        0.036226022952260704, -1.5941274572195923, 0.3692191472654626,
        0.31840120283705997, 0.8741993879399423, 0.4802653460337955,
        0.3012459045041651, 0.5102022084743536, 0.3727970282915065,
        0.6665750190815365, -0.7773615380935764, 0.12852119124454983,
        0.6774482070442244, -0.34235651892527574, -1.1577831131801597,
        -0.2879120353476077, 1.157549789799121, -0.1818163295634488,
        -0.034519908964088415, -0.6744130553492667, 1.1322140576298956,
        0.5044463860518625, 1.5469749343656427, -0.19451127779487945,
        0.16868157432748737, 0.3887158384137858, 1.179393002549757,
        0.4377598134949622, 0.42273561999328285, 0.17555703442650725,
        0.7637154786900613, 0.3204620558964089, -1.0127445325141415,
        -0.3366137672636463, -0.6128563234467006, -0.19959799618607235,
        -0.22993024268879514, 0.6548635589470768, 0.5449412421525476,
        0.11171602982233311, 0.5174688869584806, -0.0926785574168733,
        -0.012796553414024043, 0.872831179387319, -0.3738274777631416,
        0.708424995234135, 1.1207261796968788, 0.39043722964884914,
        1.5466373285390471, -0.0566526099067629, -1.544789451209757
      ],
      [
        0.01970245038838479, 0.18403088824160574, 0.23516669011749736,
        0.3619340287619915, 0.7559235356843684, 0.8037553588156275,
        0.8037553588156274, 0.8037553588156274, 1.523650120002224,
        1.5399034674182392, 3.5267025169505333, 3.526702516950533,
        4.657784878324055, 4.735234101549794, 4.768060921347247,
        6.910522417024203, 6.910522417024203, 7.937298848041795,
        7.937298848041795, 7.937298848041795, 7.937298848041795,
        7.937298848041795, 7.937298848041795, 7.937298848041795,
        8.950027818739875, 8.950027818739875, 8.950027818739875,
        8.950027818739875, 8.950027818739875, 9.275481401407285,
        0.034552241786943605, 0.7960682992937013, -0.16960774395822967,
        -0.13488653659207303, -0.07127010448742209, 0.7213919487775996,
        0.07517487951530155, 0.7669403129297154, -0.0980146039609658,
        0.2841753594230342, 0.41897129078802076, 0.7644737129881134,
        0.21659836679204617, 0.40978346593820614, 0.23386906952753808,
        0.6351364889148511, 0.33021983360135304, 0.3518425622667454,
        -0.16759580526603354, 1.1955178055405769, -0.1119172073880175,
        -1.6647459335605923, -0.09499524124538847, 1.171044098528735,
        -0.022137095989983098, 0.46479840085551427, 0.5434533112600137,
        0.7953483283824695, -0.23791626316884204, -0.34327459028867535,
        0.9770824990177593, 0.3972109926583832, 0.031305244787475206,
        0.06660894739153407, -0.4270300066285869, -1.4580475210852422,
        0.18899331747125298, -0.5789031865333153, 0.2203088633995836,
        -0.028805094274594364, -0.21236041446549625, 0.00835869807102751,
        1.8444421334304235, -0.36021419267454113, -1.0777998782841605,
        0.7201309879688491, -0.07151832135087417, 0.013523038580686776,
        -0.5101061898109359, 1.528477364550823, -0.24055091899624312,
        1.595727742687772, 1.181011187425284, -0.07205139039345279,
        -0.3645912646252544, 0.922259297261975, 0.47504473393792157,
        -1.4582846498754758, -1.1041238978674286, -0.08619812725702276,
        1.5348185477516838, -0.034799821636765677, 0.34854563969795865,
        -0.3057886345189525, 0.3435344949085216, 2.387989506593159,
        0.5928805156422549, -0.02250711897690342, 0.734685803060112,
        1.1230348216575474, 0.9339212770561773, 0.5429657194529808,
        -0.9530889967003539, 1.2607191116533525, -0.18262479735843284,
        0.2292294020716647, 0.484625167272873, 2.2621526738562925,
        0.3832060422832924, 0.2504382199240898, -1.1186566372739195,
        1.0354182359738777, -0.9045076995614423, 1.0282595509077306,
        1.805679851173207, 0.9332861023326164, 1.4396403686507162,
        1.6178312922032976, -0.22196274260736226, 0.19030625281227892,
        -0.32840557234129963, 1.004592356770436, 1.8720477930131976,
        -0.06388076228748135, 0.12235432131563899, -0.5998878734536057,
        -0.5461403115162753, -0.17116133229966776, 0.6826247841010238,
        0.6607748570434985, 0.7854114346995006, 0.5612002866021459,
        -0.2559995100181322, -0.8863827207156498, 0.2553569774973194,
        0.6372473265785513, -0.14017909069433732, 0.016226196464851673,
        -0.10437448541592237, 2.5268983957827906, 2.3709647446626767,
        -0.8108547070158446, 0.5698393243760288, -1.2042979310590165,
        -0.5004321415825274, -1.0362881146071494, -0.18531750144204898,
        1.5646886079478448, 0.08968487420602586, -1.6120268318409705
      ]
    ]

# === HELPER FUNCTIONS ===

def set_output_prefix(config, index):
    """Set output filename prefix in the config for the given run index."""
    sample_tag = f"{STATIC_PREFIX}_sample#{index + 1}"
    config["output"]["file_name_prefix"] = sample_tag
    return sample_tag  # return it so we can use it to load output

def set_init_param(config, param):
    """Set the init_param value in the config."""
    config["init_param"]["value"] = param

def run_main():
    """Run the main.py script with the given config."""
    subprocess.run(["python", "main.py", CONFIG_PATH], check=True)

def load_output_json_by_prefix(prefix):
    """Load a single JSON output file by matching its filename prefix."""
    base_path = "output"
    if not os.path.isdir(base_path):
        print(f"[!] Directory '{base_path}' not found.")
        return None

    for root, _, files in os.walk(base_path):
        for file in files:
            if file.endswith(".json") and prefix in file:
                file_path = os.path.join(root, file)
                try:
                    with open(file_path, "r") as f:
                        data = json.load(f)
                        print(f"[+] Loaded {file_path}")
                        return data
                except Exception as e:
                    print(f"[!] Failed to load {file_path}: {e}")
                    return None

    print(f"[!] No output file found for prefix: {prefix}")
    return None


# === MAIN AUTOMATION LOOP ===

def main():
    for i in range(NUM_RUNS):
        print(f"\n=== Running redundant + zne iteration {i + 1}/{NUM_RUNS} ===")

        # REDUNDANT RUN
        with open(CONFIG_PATH, "r") as f:
            config = yaml.safe_load(f)

        config["run"] = "redundant"
        prefix = set_output_prefix(config, i)
        set_init_param(config, OPTIMIZED_PARAM[i])
        config["zne"]["data_points"] = None

        with open(CONFIG_PATH, "w") as f:
            yaml.dump(config, f, sort_keys=False)

        run_main()

        # LOAD OUTPUT JSON
        data = load_output_json_by_prefix(prefix)
        if data is None:
            print(f"[!] Skipping zne for sample#{i + 1} due to missing redundant output.")
            continue

        # ZNE RUN
        optimized_param = data["config"]["init_param"]["value"]
        data_points = data["output"].get("data_points", None)

        print(f"Data points from output sample#{i+1}: {data_points}")

        with open(CONFIG_PATH, "r") as f:
            config = yaml.safe_load(f)

        config["run"] = "zne"
        config["zne"]["data_points"] = data_points
        set_output_prefix(config, i)  # same prefix
        set_init_param(config, optimized_param)

        with open(CONFIG_PATH, "w") as f:
            yaml.dump(config, f, sort_keys=False)

        run_main()


if __name__ == "__main__":
    main()
