"""
Automation for redundant and ZNE runs.
"""

import os
import yaml
import json
import subprocess

# === CONFIGURATION ===
OPTIMIZED_PARAM = [
      [
        -4.1290471568429383e-17, 0.028387941050870547, 0.028387941050870516,
        0.028387941050870544, 0.4764187545019148, 0.485154879376271,
        0.7094706976105217, 2.998376901501724, 3.486264965503922,
        3.487775573446841, 4.058897205630428, 5.020552086463093,
        5.02158492362958, 5.02158492362958, 5.0846878698400815,
        5.0846878698400815, 6.794704827143902, 6.794704827143902,
        6.794704827143902, 8.013356083289752, 8.21076169573117,
        8.21076169573117, 8.633075344303478, 8.633075344303478,
        8.930018414781724, 8.930018414781724, 8.930018414781724,
        9.990329186240457, 9.990329186240457, 12.915390927357043,
        0.8289215528981712, 0.6465354442587259, -0.06922368073773534,
        -2.0853926237797484, 0.25605409461249207, -0.765586831155604,
        0.9589723041272441, 0.27455658215646966, -0.07189982532198122,
        -0.3449139525561357, -0.46800027418386986, 1.016480689947782,
        -0.9706976058410632, -0.9556868223128826, 0.9323574793538898,
        -0.4376613900889883, 0.44138701419965265, 1.4418520162063444,
        0.8420619129497768, -0.025530845682239494, -2.3076344184440156,
        0.37458463155346333, -0.47031338116346383, 0.07338001085955462,
        -0.869249007732584, 1.6824786550253577, 1.719346297136726,
        -0.9622509832303179, 0.5779076253870294, 0.4760527439731688,
        -0.2451715046346434, 1.5906513054768954, 0.35918458386075697,
        -0.44817294000256097, -0.37416377940751877, 0.37048554789855764,
        0.693137718643464, 2.288219219235325, -0.26501198620577204,
        0.3689053264668303, 0.10166782579927121, -0.3356073800920907,
        -0.6413954053758932, 0.28636656044125136, -0.8690978212322298,
        1.166030172665772, -0.46365263204645707, -0.8505396438729699,
        2.4328989003329693, -1.4554443951257197, 2.09134311034601,
        1.7695145471360614, 1.1170184462314887, 0.20325573406500014,
        0.34206355374635444, 0.016804831103183593, -0.19882507083844791,
        1.4011478969931443, -0.0572616468882171, -1.3773340344964602,
        1.1031086912886459, 0.47433623341773395, -0.037679845343088075,
        0.7450954028512253, 1.3114871459373192, -0.18651966717154955,
        1.0750199871192778, 0.48905379729033566, -0.6281827821606347,
        1.322074656325554, -1.4761484868509396, 0.2859918816514792,
        -1.0033541595176405, 0.8264053813863532, 0.622010811103528,
        1.1636747207646185, -0.31883271288389914, -0.0013981850979601159,
        -0.09999405171802342, 1.3085280853238759, -1.3727969089464465,
        -0.08341159264840771, 1.6249369276484606, -0.28082331570516694,
        1.863294400254821, 2.2932652495309953, 1.4849536675442596,
        0.6811668802751195, 1.5380110980874968, -0.6615225065895972,
        0.4000828281024264, 0.33932121588009856, 0.48855764825038867,
        2.5371111232777053, -0.7260430040504564, 0.09005940379987407,
        -0.8762980817992282, -0.23800314057977784, 0.9728027685352436,
        -0.20857834368009137, 0.6148333457084475, -1.5171898336040224,
        0.8658542069129427, -1.6478287868490311, 0.5770049367106069,
        0.134497700004433, -0.11612046371881249, 1.5826352840237945,
        1.6045820840261675, -0.08805669980595342, -1.507745125921201,
        -0.11276651576435986, 0.07206005105970639, -1.7788122679933258,
        -0.002988765738482436, 0.7255804452314191, 2.7661804504965604,
        -3.1943627011957507, -0.07088434770936546, 0.10949711075632612
      ],
      [
        0.27654223573266234, 0.27654223573266246, 0.27654223573266246,
        0.4643738922966213, 0.6582164862517121, 0.6582164862517121,
        0.6582164862517121, 1.3424523496852623, 1.47635793598756,
        1.47635793598756, 3.385550316280557, 3.385550316280557,
        3.385550316280557, 4.494062371253785, 4.494062371253785,
        5.0204758683966135, 5.023404188660082, 7.05704094573064,
        7.087391629397132, 7.533802135057517, 8.245970909352765,
        8.390887842007308, 8.390887842007308, 8.703391612007538,
        8.703391612007538, 9.485545381639698, 9.485545381639698,
        9.849437794456351, 9.849437794456351, 10.799155842585746,
        -0.12708089143278917, 1.4168148977025445, -0.13519536748631492,
        -0.32308714516775877, 0.06981336221044306, -0.034321895006426455,
        -0.18209443759399158, -0.024858958594746107, 0.664488174834645,
        0.6897317665852637, -0.008774731192519907, 0.625642551337688,
        0.6862410821653743, -0.7670419540542446, -0.48055390132433673,
        1.573964677292243, -1.0555745677813198, 1.3159721165631335,
        -0.9138502497993347, -0.4641566084568084, -0.06966564000847691,
        0.039012746519005555, 1.0827641697579717, 1.2190093772283843,
        1.5391150382377632, -0.6675581491933664, 0.09104662559232415,
        0.5283818781579022, 0.04478118244404365, 1.5836075485651113,
        0.251932560991488, -0.3949560381811925, 0.8854639388207172,
        -0.8611267164776638, 1.566928747241295, -0.15445151319573347,
        -0.01396050433941564, 0.8172620115356718, -0.014658132241289147,
        -0.6623010385304499, 0.6299284572753584, -0.15026947869759505,
        -1.2293112897827836, -0.5768656731979434, 1.231557922062332,
        -1.447872926116422, 1.4918722706131171, 0.31945486783385635,
        0.43870804207253483, 1.3582636256308331, -0.8478398442626237,
        0.799518029891469, 0.5539369896048497, 0.13453197415145846,
        0.7167498104862234, -0.06589109804263343, 0.041038724923082276,
        1.151975756926885, -0.052026838729968425, 0.3952978000808587,
        -1.1754748970457833, -0.01965607042871015, -0.2456324144680547,
        -0.01136184217607491, 0.022503168314325715, 1.1777923723104653,
        0.14554117253938412, -1.2287946167385297, -0.9683737383161766,
        1.073329622962756, -0.7143583802799215, -0.3545002682598469,
        -0.31906110571926777, -0.9597094503848127, 0.8825903987559673,
        -0.08273415521500459, 0.2895039435279609, -0.3388594197258312,
        0.2406459434933063, 0.3824128671502841, -0.5390555829405563,
        0.3757684495816124, -0.5015719636333678, 0.3958257688275076,
        -0.6428354095046468, -0.9178624992467067, 0.29327306512581747,
        -0.09193285724698198, 0.1770091195095364, 0.6803523512851801,
        1.05525770275555, -0.4646437845139076, 2.2560908642344026,
        -0.7500939262299234, 1.92959092052175, -0.36895777993274226,
        -0.04538283416771957, 1.2529586558275392, -0.57805717638909,
        0.3080585810325818, 0.031910210614104206, 0.18519950010488512,
        1.3888566879174211, 1.087260914864616, 0.15259355623633358,
        -0.08810167996863522, 0.07467874103808375, 1.4444893382870363,
        -1.446220680213735, 0.8215180856176293, 2.0151723649306295,
        0.13454991965456886, 0.21923381008732426, 0.31112145477192793,
        -0.8977876743954992, 0.10239876571985529, -1.0132922278363503,
        -0.3794863035801566, 0.8437803973608401, 1.111671691788496
      ],
      [
        0.3463233138801294, 0.34632331388012944, 0.3463233138801294,
        0.3463233138801293, 1.2403205490491955, 1.38033446895038,
        3.6939218351946623, 3.6939218351946623, 3.693921835194662,
        3.693921835194662, 3.9412089126587, 3.9412089126587, 3.9412089126587007,
        3.9412089126587007, 4.8310999601027795, 4.870844593548848,
        4.900228671797898, 4.9002286717978984, 4.9002286717978984,
        4.900228671797898, 5.70167657474683, 6.21188441483336, 6.21188441483336,
        6.686419232103557, 6.723504371727371, 7.618130890836856,
        7.618130890836856, 9.420364260644014, 9.420364260644014,
        10.775132222422771, -0.3525750090684208, 1.2748976558430758,
        -0.16146998454247521, 1.3224575871686013, 0.0349265192498484,
        0.36138711032415904, -0.5043488106619078, 0.7634801084306476,
        -0.3536814593617201, 0.9606809354246906, -1.1143894720984433,
        -0.45289061390722213, -0.1605333784989486, -1.594210268458609,
        -0.09465166736510336, 0.11132251138190599, 1.004235666711761,
        -0.23115493220428254, 0.9451761882751959, -0.3707284170975133,
        -0.17782948231634454, -0.18433417990028922, -0.06421460341189031,
        -1.155489001827845, -0.2074908306187579, -0.036360325422879626,
        0.5283181819327893, 0.3603171208434518, 0.6819349944270952,
        -0.2733083993242672, 0.7075879191324372, -0.042779623335368125,
        0.7032435595714176, -0.7363942983542189, 0.9583235184546098,
        -0.5892472427173001, -0.7139877518112785, -0.12446625268371646,
        -0.439646171766664, 0.7129808957109575, 0.3373075268097138,
        0.3345550414369601, -0.38068761370203624, 0.07864964370676188,
        -0.3383553862900091, 0.6633419895127639, -0.578720703894673,
        0.486162302530746, -0.06112668401522289, 0.34417654454775265,
        -0.09182266750822224, 0.012215000731405658, 0.5658291917160285,
        -0.16728488191683846, 0.3754616489195623, -0.30497315054621493,
        -0.7559846133933803, 0.9474959005813702, -0.5904076686561035,
        -0.2620011537974264, 0.1328515248519479, -0.44066408562446224,
        -0.7849425610737308, 0.44059474279745625, -0.04646983134951628,
        0.27897770882356554, 0.36838349877106535, 1.1610009997739648,
        0.9058411506824863, 0.3119955912029684, -0.5265683545543336,
        1.0661822357546584, 0.8560044406571757, 0.5004409227892788,
        0.5192086876555008, -0.0019665558968806392, -0.23949800878404184,
        0.32563956832297103, 0.795323960796817, 1.5213873243487468,
        0.8637563634588281, 0.07945031145196896, 1.7583315097859118,
        0.5335864884320034, -0.1366270407456156, -0.9111102828185913,
        -0.41650979281126865, 0.20926691692934202, 0.2776061293997892,
        1.4257231544028384, -0.10754544247245298, 1.0035199546983695,
        1.1162390986419686, 1.7211522778091677, -1.4332245925979028,
        1.4417595659646931, -2.106784537892007, -0.6878309432904478,
        -0.20360639354575213, 0.6373705186717347, 0.051333236332203484,
        -0.35868991955772395, -0.24365907607080922, 1.619736185871098,
        0.5895182658245096, -0.6086170057348131, 0.39774539931448055,
        1.409837948786624, 0.17438880158294706, -0.0415548590378924,
        0.1413623732119859, -0.8192475896231625, 0.5823982141653503,
        -0.8462302367353051, -0.60454163385331, 1.8216629921858374,
        1.2634551976945552, -0.40200420270308274, -1.5954759495917508,
        -1.7732438129518737
      ],
      [
        0.23818326834520384, 0.242015507589488, 0.5292100600091615,
        0.5598196968290768, 0.5598196968290768, 2.3451854381830244,
        2.3451854381830244, 3.8453025861748578, 3.8453025861748578,
        4.395137112369032, 4.408833101975425, 4.829585475162733,
        4.867115107997544, 5.058958687371625, 5.058958687371625,
        5.058958687371625, 5.581243202757385, 6.011433944644334,
        6.011433944644334, 8.358003932454157, 8.358003932454157,
        8.358003932454157, 8.371420896509267, 8.783744346022278,
        8.783744346022278, 9.34189587380724, 9.34189587380724, 9.39608576624051,
        9.726727464435275, 10.95102910414735, 0.14721560345391302,
        1.0205767628001141, 0.40564926087548847, -1.9238321605823567,
        -0.04729505851188324, 0.482541600628026, 0.11521556777775581,
        0.8524320040134185, 0.42380767990264745, -0.6219665889019169,
        -0.05759638705357143, 0.8161328242190486, 0.7425402472775383,
        0.7535392998290764, 1.8314745216576223, 1.3334023135030668,
        0.05552193989453376, 0.9691374289368472, -0.07338372949421543,
        -0.6690664310785921, 1.168533104165511, -0.01962836639606316,
        0.6576122461884292, -0.037637936325233226, -0.0009647519828692927,
        0.4524839512418326, -0.013115244288784337, 1.6270372625341938,
        1.182284078721198, 0.9533845712158122, 1.0956662941001023,
        -0.9647918240366662, 0.1897778948773928, -0.04047520420354409,
        0.5790278460715794, 0.631719469583885, -0.3335418357294817,
        1.0603186443819097, -0.7449471003423949, 0.1630231005006795,
        -0.07563007210422526, -1.1009042311153838, -0.34587951137957407,
        -0.22408475871037167, -0.6364303490666092, -0.5245531829065874,
        -0.7807390048523051, -0.7767575864285188, -0.9679768325508518,
        -1.8691843526791756, 0.4783530568164554, 0.6133546874260105,
        -0.20020986269221935, -0.41532071148562183, -0.8557118152516873,
        -0.16985308585729458, 0.8428338023785568, 0.6750667051632169,
        1.2795031602880573, -0.41384224674171627, 0.3213362409234008,
        1.2340309605381181, 1.0506369357289735, -0.6415500741723684,
        -0.9628453188140567, 1.935214357876566, 1.4159154638103797,
        -2.0864443113151867, -0.07426020994129089, -1.0538315394110076,
        0.2589745455351295, -0.2955978932252484, -0.030644528099012087,
        -0.8602288471584197, -0.09490606960216369, 0.4190622694749842,
        -1.5667390101922392, -0.7804920738383083, 0.1255849265457167,
        0.5884338319364165, -0.46028089859616994, 0.2488277677353687,
        -0.7513271615815256, -1.0561258734551267, 0.3697237180501531,
        -0.7108432439071602, 0.5137418203820399, 0.946767478727941,
        1.619957961978311, 1.2944079622561346, 0.21625880379379211,
        0.007168703139473973, -0.334764182643075, -0.9086121674985949,
        -0.8247776105092918, -0.5734460393428641, -0.4381826298821608,
        -0.44306191141826123, -0.23860269421390362, -0.03343496826073402,
        -0.008972211649351379, 1.2196121588758198, 1.5985131140815898,
        0.060325450296581484, -0.7312434635304047, 0.9413542695101463,
        -0.6701271691421761, -1.0680925542186157, -0.5192506372311365,
        1.5594784335685845, 0.17928043514789443, 0.2455246384495121,
        -0.053106843359071614, 0.7488220810664211, 1.3030207698426615,
        -1.787387332504871, -1.1184519607509558, -0.2511275398302805,
        1.445676213762956, 1.5991220174606833
      ],
      [
        0.32980400918867037, 0.7818596814437996, 0.9680306497310072,
        1.0586432954274991, 1.7663116348413028, 1.8956491295658664,
        2.0436116769319477, 2.0436116769319477, 2.0436116769319477,
        2.1846619555479685, 2.1846619555479685, 4.516997836642403,
        4.516997836642403, 5.3166564351730035, 5.320130741320412,
        5.399447086770547, 5.400046100307029, 5.400046100307029,
        5.400046100307029, 5.400046100307029, 7.097750404951498,
        7.618222769006738, 7.956666567531361, 7.956666567531361,
        8.961109688308255, 8.961109688308255, 11.028500695271937,
        11.5809418583784, 11.5809418583784, 11.5809418583784,
        0.24114173221382337, 1.3754512844042854, 0.9720111739434927,
        -0.29877116871955545, -0.029737313498699618, 0.3185153459444675,
        -0.31840745367437817, 0.6801602139502809, -0.015407845998522466,
        -1.114484654283524, 0.22997676136047449, 1.5201821520192487,
        0.3217486942799661, 0.43678760134757944, 0.17618749246228715,
        0.7010359103792874, 0.3446701255696699, 1.4700166379981474,
        0.3471333265905846, -0.968444017764766, -1.1485269521507444,
        0.3282504398407059, -0.7898554413193151, -0.22157985789400653,
        0.4570931682042821, -0.22158635023930806, -0.36549836384277606,
        -0.2366283880333898, 0.4114765778384287, -0.7694643480660831,
        -0.40507000819737765, -0.6576468499882752, 0.2023600853039859,
        -1.2917280200640486, 0.32702771491506877, -0.07546137553843744,
        -0.7713328193108817, -0.8163562225239717, -0.07772489804090182,
        -0.32841576637855896, -0.05728139293162625, 0.8564947637293437,
        0.15384434981345546, 0.41944080031994563, 0.16884394015055976,
        -0.010490661309829376, -1.3198249528292274, 0.07128101806419536,
        0.03515395872296211, -0.09826644736389979, -0.06882299183557238,
        -0.7062443088386591, -0.5280915567870916, 0.14860690208212682,
        0.338235073517239, 0.012130023587481156, -0.037483081002571056,
        0.8881056862099682, 0.06312673968269537, -0.44738898868242327,
        -0.2463284936792685, 1.1708672891281489, 0.5297819270424092,
        -0.5463182826640249, -1.667403353493104, 1.3713545814180228,
        0.9413366263710182, -0.021951472934173096, 1.0345046397029698,
        -0.8002739446090432, 1.076242700462428, 0.04994674089563993,
        -1.446235170371471, -0.3268246709561185, 0.6264234635598642,
        -1.2465048991503196, 0.1169092097763034, 1.2453937722962254,
        0.7220287063888942, 0.8114212311039525, 0.18333674920471413,
        0.7345776889004225, 0.9807678368065545, 0.8703572591074042,
        0.28720991162605214, -0.9085817320602367, 1.1216621938695932,
        1.1327477502874412, -1.8285395156530388, 1.4231155243966302,
        0.08156271721069372, 0.18027327076782884, -0.10302960773112253,
        -0.5560482514096969, -0.09484541903718098, 0.5886430341587933,
        -1.1674014904638685, -0.03940950630369794, 0.2792515765657198,
        0.08214125135098017, 0.04344924016389119, -0.7787970529711157,
        0.07887586110139429, 0.7532574519080738, 0.17107625040009872,
        -0.4128415687827808, 1.3723943620028143, 1.4278581324344195,
        0.5879977529754344, 0.28910810409117477, -1.4412046993697643,
        1.624844367134446, 0.19366683662945536, 0.3179841250458877,
        0.5357240606734743, 1.5680682524509713, 0.04418323830986127,
        0.2311137213204739, 2.8741283660232546, 0.9612408402592636
      ],
      [
        0.46756606893882113, 0.46983859896604685, 0.5133985927484581,
        0.5133985927484581, 0.5133985927484581, 1.4016794842576101,
        1.6914116785996751, 1.691411678599675, 1.6941756924801525,
        1.6941756924801528, 3.749864451084885, 3.749864451084885,
        3.7498644510848855, 3.7498644510848855, 4.969636107010246,
        4.969636107010246, 4.969636107010246, 4.969636107010246,
        5.983107385388112, 5.983107385388112, 8.378949246097575,
        8.378949246097575, 8.635680633753974, 8.635680633753974,
        9.108807770997622, 9.108807770997622, 9.108807770997622,
        9.960036411132767, 10.436643041587223, 10.716533289695375,
        0.5466515694267952, 3.318518267704871, 0.40678728382369284,
        0.6290091030083763, -0.4770983795300032, -0.7455483390932742,
        0.1630064768968011, 0.4889724943271746, 0.10596004146863507,
        -1.4759536729524354, 0.957604974713893, 0.6004514101153323,
        0.0725728265044025, 1.4994700617905987, 0.15508641282397265,
        -0.15494303336158094, -0.5663845144966579, 2.6663065398173496,
        -0.27086336898318036, -1.1828784814640632, -0.295045685212881,
        0.6236994649007899, 1.1769360493970402, 1.7159795997719172,
        -0.3019600780315931, 0.651545330446025, -2.0782382222089724,
        0.3186344830290561, -0.2815476257680432, 0.4067635126151388,
        -0.8228051832090519, -0.4154478828430832, 2.3723163321732827,
        0.931436930203099, 0.9804374423714106, 0.058895326584719035,
        0.3167253661454302, 0.3390503539155689, -0.5024758650485814,
        -0.2425872659725522, -0.6703364135359525, -0.147558399690948,
        1.1644296968010859, 0.5475507579506065, 0.1736068872874216,
        0.30547527216138975, 0.5300773267023443, 0.7722201656261689,
        -0.6858549484151734, -0.16073113081558088, -1.197458252004488,
        -0.507307082981415, -0.16437738354723153, 0.2647407403580543,
        -0.45930133674563567, -0.22673992276266391, 1.8127715449849986,
        -1.4334128748253496, -0.759404859696163, 1.2431110601081345,
        0.8953271645792334, 0.6963251389999259, -0.23147129445607595,
        0.3638861144885483, 2.2394622330281906, 1.543816783446588,
        1.7535830084845025, -0.3169637330795974, 0.2453194636587019,
        2.0076391670843647, 0.286017506499548, 0.6600449842625801,
        0.19782118041633945, 0.05463577684798935, 0.4755005320975566,
        0.055207215781380096, 0.06969685609102444, 0.2645328829673777,
        -0.01235845210357445, 1.01982876424508, 2.262492417600915,
        1.3443784687440867, 0.10698144982242018, 0.428081928456963,
        -1.5494921893757727, 1.0701294130786736, 0.39987519173641656,
        0.06301738855484718, -1.6711192593807125, 0.26920159401030147,
        -0.08358711295948693, 0.4054786916979446, -0.5013194648307361,
        2.126550690771933, 0.10959959792145137, 0.4205360694942305,
        -0.586878230803869, -0.3381608637889511, -0.5055401953468239,
        -0.45995744817477163, 0.07999668782445096, -0.4269018063306222,
        0.9588276598807326, 1.042187521522261, 0.07821502449201799,
        0.6777167152964713, 0.4177387822172794, -0.18721284346239236,
        -0.8064458441104513, 2.8712851588196218, 0.7141862154478698,
        -0.9976723444987857, -0.8529435737233043, 1.9602636639541733,
        1.2634521849205176, -0.7170870121313951, 0.31227949023655405,
        -1.0451293221946831, -0.6787852158143914, 1.8581833428208436
      ],
      [
        0.4319322451408806, 0.4441934852523559, 0.5878315575931067,
        0.5878315575931067, 0.5912427958750637, 0.5947187380620651,
        0.5947187380620652, 1.5628074958209335, 1.568718083448373,
        2.013035808837258, 2.013035808837258, 2.013035808837258,
        2.0277481086167364, 4.114573484042011, 4.1154343976538055,
        5.358852938788934, 5.358852938788934, 5.549639110185835,
        5.667644288942511, 5.6706149635077026, 7.063797010237488,
        7.658675772413245, 8.123010743902626, 8.633070512181217,
        8.7849794748515, 8.7849794748515, 10.749769122252356, 10.89899813672382,
        11.413879450074099, 11.413879450074099, -0.04151001581527148,
        -2.751209241920508, -0.5056705094410174, -0.406548832581749,
        0.8633340895103881, 0.17259893989954428, -0.21235924407313156,
        -0.5485334561985523, 0.2012951527025238, -0.23858034563229433,
        2.1364176057207223, 0.7817014982866842, -0.1108899918027214,
        0.6048531661014985, 1.809261328558185, -1.1786415575821785,
        -1.0827170099436865, 0.4109384498547832, 0.8090945308822337,
        -0.9356585252219308, 0.28697429006677655, -0.15332459566133277,
        1.2998079093160566, 0.3870967504567973, -0.2413465423953762,
        1.001771196320206, 0.1138394509020578, 1.3220786271535379,
        -1.1806565063083097, 2.2789659185869464, 0.11875741943281123,
        -0.15631084464392242, -2.14680662310284, 0.18035127914430246,
        -0.260880073181003, 0.21031876899961, 0.7641152777599183,
        1.203568210035907, 1.2767673297334832, 1.2585129786889195,
        0.24752046596725819, 0.7203551788145919, -0.17420447991641552,
        -1.3486030918499698, 0.2145369555808404, 0.8896874485404291,
        -1.6470089821954121, -0.37928143051952584, -0.29903232984244293,
        0.6984471945997809, 0.14906235834494008, 0.054873949093549826,
        1.3877615433857144, 0.04193983551007985, 1.2014028569521673,
        -0.02338341588216991, -0.05255422822816251, -0.1905875093002492,
        0.16425167437144692, 0.2542835721118732, 1.1822299841866795,
        1.2032222480152739, 0.30142488752060526, 0.09125464470109583,
        -0.45638140154025475, 0.050260497156630585, -0.04000614529085093,
        0.9096133936431033, -0.03555378439095736, 0.4405325841695877,
        -0.48129885373423525, -0.3617221403442356, -2.5216506086368518,
        -0.5081934521569421, 0.041332600726076626, 0.7413771443671474,
        0.2204029987501584, -0.7517920276590782, -0.21022249714251526,
        1.5607830526955413, 0.16615947769508344, -0.17023919527139658,
        -0.4295619963603494, -1.1838803442651602, 0.6319564057885301,
        -0.3935277768061919, 0.005550337258741166, -0.4226065324972882,
        -0.3715846249960284, -0.48395498614671884, -0.4790957128536121,
        1.4427293239187895, 0.5875094653073935, 1.404722056846091,
        0.6973465258635152, 0.8623508528879442, -0.5460563718875903,
        0.8326491581513842, -2.4015389244466907, -0.04583861440999851,
        -0.36265388938085896, -0.5347868312224912, 0.49674658852292397,
        -0.6488379607428911, 1.1568053403721041, 0.30662269781395407,
        -2.013151608263867, -0.17383275003878457, 0.5036662539248705,
        1.9638910157847163, 3.118155075975211, 0.8117246453310248,
        -1.4517859264576565, -1.4946803709676548, -2.7792982516572895,
        1.1174424252005506, 2.333430423546859, 0.6903927508165344,
        -0.2883899927957993, -0.8542826896862586
      ],
      [
        0.4349098035102067, 0.5281397824211302, 0.6402833431740305,
        0.701719039924861, 0.8953768954552646, 1.4118719346144908,
        2.230113621742168, 2.6548053250922607, 3.10433397641996,
        3.1043339764199596, 4.146783795497047, 4.146783795497047,
        4.149760661232294, 4.149760661232294, 4.223539194779984,
        4.223539194779984, 6.7727886487081435, 6.7727886487081435,
        7.243551717080481, 7.282491880183138, 7.282491880183137,
        7.282491880183138, 8.806989173945695, 8.80698917394569,
        9.706285648296737, 9.809777023075187, 9.837118725166619,
        10.701586770517197, 11.185931122995514, 11.185931122995514,
        0.39919688039300266, 1.4533249104921768, 0.7852252158845567,
        -0.4957764525834907, -0.3354719566017423, 0.16097458435951068,
        -0.21971891747261646, 1.5370438656668401, 0.26531517225969137,
        -0.6386119707402834, 0.37748437574064975, 1.2333814560270282,
        0.5934062959304571, 1.633059089666515, 0.31170790405459564,
        0.3995146629536743, -0.11155094016301184, 0.8138063699882787,
        0.019467271717771087, -0.38186317682975884, -2.778803401027002,
        0.7887082829537533, -3.1348050840084074, -1.5109224736536222,
        -0.38589710406642097, -1.105927053527023, 0.3451707237315739,
        0.6290043291617069, -1.834722402137916, -1.0551446159380258,
        -1.3581260193610523, 0.9666180881078981, -0.05759676522292653,
        1.1866392284178628, -1.1308471740259582, 0.34327443183487805,
        0.17662613760194443, -0.043135596735193626, -0.03667546733606037,
        -0.4901895513664937, -1.0399227541005371, 0.4880459765792483,
        0.053089003166299456, -0.6259966396796703, 0.03159579372412852,
        -0.09798805529491862, 0.052872660107769434, 1.490194875693949,
        0.22167423812356596, -0.33497064714209324, 1.0144679614160885,
        0.01608415027143934, 0.49167899744128424, 0.12491439548600353,
        -0.1329609067962543, 0.8639852596635488, -1.6607871811173882,
        0.2801513494447602, 0.3908501333463579, 0.6044891435983025,
        0.08637544621327581, 1.2270127042754213, 0.11860545946003472,
        -0.13066468162372125, -0.998222267933649, -1.2643438207146234,
        0.7835210648968657, 0.8370312354478452, 0.06527740704106412,
        -1.0235950282739155, -0.705070781232052, 0.037682760290170314,
        1.4778132318704873, 1.7053977225841355, -0.1291331271719845,
        0.1648924115529835, 2.208642048449397, 1.1885953055185114,
        -0.8138037079028133, 0.6715189891287302, 0.7819572861394978,
        -0.4022064636590845, -0.3927127310055937, -0.4118784323717791,
        1.3463239978578432, -0.3323606385924751, 0.6664683657180488,
        1.58852177854836, -1.212203169826861, -0.031436536468697034,
        0.5094262403458202, -0.0616688967239856, -0.0666169691754888,
        -0.7277012125404719, -0.12684196683036533, 0.5325519345188151,
        2.2778420441533447, 0.8735933622003313, 0.9907279467768721,
        1.1448787224294625, 0.4291077507842401, -0.21356701746617238,
        1.7174041100732933, 0.1885112766205208, 0.3630143936992631,
        0.6395640633025061, -0.2937369198596852, -0.18128670495631546,
        0.9504587478277511, -0.6241293783488098, 1.8733903679237267,
        0.4875344831143031, -0.9182747577406853, 0.850791268752179,
        -0.46183623376516114, -0.634145646812118, -0.9165900492445601,
        -0.8973746003077631, -0.879107286657044, 0.15645801311276636
      ],
      [
        0.48023040681030116, 0.7029544315470944, 0.722671987246733,
        0.9307929858945541, 0.9307929858945543, 2.546598088688794,
        2.546598088688794, 2.546598088688794, 2.546598088688794,
        5.184334435330857, 5.195111458618343, 5.47436411399969,
        5.47436411399969, 5.47436411399969, 5.47436411399969, 5.47436411399969,
        6.068336244524409, 6.068336244524409, 7.838605251840715,
        7.912250316107233, 7.912250316107233, 8.562517202814183,
        9.063385768597811, 9.216218862905647, 9.216218862905647,
        10.84047371877396, 10.84047371877396, 11.044358714867027,
        11.375406566932424, 11.375406566932424, 0.18886549713610382,
        0.6040291443391601, -0.9727809979878402, 3.008209947509642,
        0.3239743149147096, -0.643987619924633, 1.0739882269552894,
        0.4935103262912805, -1.1713673989643745, 0.32339055167680386,
        -0.8254170399860232, 3.387204293956005, 0.5437302598099015,
        -0.6585961721148387, 1.0903163929414719, -1.5261906384818182,
        1.102349928722959, -0.7373436929054379, 0.1712635196093208,
        1.2086697581514199, -0.4977298668106944, -0.8828019932256734,
        -0.13051782426094366, 0.048744185631251574, -1.0535030780910155,
        0.5224555306604155, -0.9502111367985572, -0.2573420205933925,
        1.5833039752620888, 1.3806480812363842, 0.3864833677006273,
        -0.0006284730712113316, 0.6487740408134013, 1.697829570896293,
        -0.20023867528920775, -0.32438662287273723, 1.3674639807988553,
        -1.5592347723565667, -0.6294582959326964, 1.111157394071659,
        1.4895912958038178, -0.7203901402661329, -0.027076706863032294,
        0.009574786781832467, 1.1437695218822916, 0.11720143179507149,
        1.0973549625545624, -1.0756168303605034, -1.5785125289756954,
        -0.42999007233668873, 0.7592603373612552, 0.7357293999316703,
        0.03766014972468404, 1.450035910180884, -0.08978031589044846,
        0.7176267391661779, -2.3377280976646966, 0.3878354316208249,
        -0.8070070584177742, 0.07084117333557359, -0.008998168433091903,
        0.6612796195456235, 0.6287929626789847, 0.8601333603228948,
        -0.7786354708155643, -0.144476679155352, 0.39492950957300044,
        -0.20012968159779548, 0.01326107241550192, -0.5649340596325207,
        -0.020398755490040426, 0.6333499066300691, 0.400844220606507,
        0.5954749034740784, 0.8700413681534388, 1.315868035063538,
        0.9914334712755634, 0.10418309057983809, 1.1095991500751576,
        -0.1712743534684691, -0.2730581386141925, 0.1453142903679217,
        -0.3813955795194703, 0.1280814941289577, -0.5627986213807415,
        -1.0576722394029623, -1.98721560251358, 0.519862592148374,
        1.03695228961559, 0.21101375663462807, -1.750252459751414,
        -1.1450993785481438, -2.2517541986316916, -1.5456964825715331,
        0.6026638989139771, 0.47561448130168205, 0.08201672609434518,
        0.47464262797792917, -0.14585857152212733, 0.08636040211648545,
        0.7388192170680543, 1.071366965639021, 2.5115163876343742,
        -0.4286872636197954, -0.2977998181526895, 0.46569070003689333,
        0.2115019986130443, -0.5123638542481742, 0.09024611293676764,
        -0.3380729423866059, 1.6314769884628497, 1.3338027138849353,
        -0.7442166070564612, 1.2186722356710948, 1.584709484399307,
        -0.6554175978902271, 0.36887213174672207, -1.365021965092438,
        -0.4623126041921459, 0.4869420326570461
      ],
      [
        0.5118290521669792, 0.9034573591840084, 1.0514460879099101,
        1.1283814725964603, 1.1293980629167455, 1.6874068541059999,
        1.8362001710030256, 2.594529848453243, 2.5949023258749775,
        4.384420392533986, 4.804388533064279, 4.8044974726668155,
        4.925049921883437, 4.925049921883437, 6.055903002618935,
        6.0650337145794, 6.06510024924717, 6.06510024924717, 7.719643893437192,
        7.719643893437192, 8.110116534451196, 8.374448879129652,
        8.374448879129652, 9.29045698473019, 9.2929923765699, 9.977025927736127,
        9.977025927736127, 9.977438303479875, 11.277250876863835,
        11.588901828478656, -0.5970483257864091, 1.048395642841534,
        0.3563299433581316, 2.04182497417867, -1.0659189653240388,
        -1.5711224255679066, -0.6854026923334804, 1.3002799990574343,
        0.334979527312172, -0.41771661057992626, -0.5255960701407614,
        0.9200835209290303, 0.5840294212204432, 0.4309612994747514,
        0.010788324288593443, 0.8398650983618882, 0.35555521736822654,
        0.33383672576306345, -0.03972798241435421, -0.5808926346218187,
        -0.6217506829607715, -0.022449055124049946, -0.4671428723737863,
        1.3840583406465645, 3.321823997583478, 1.9516123562000514,
        2.109430068020724, 0.17138900458361278, 1.0734765554988877,
        1.1591682463434823, -1.5085197494005436, 0.3709514368460093,
        -0.08354812013321816, -0.6849414455501801, -1.1807064172516142,
        0.1889544406654655, 0.45125852432694835, 0.40946867023093825,
        0.9591749175330944, 0.862406962512403, -0.47565451021668054,
        0.14791469386649075, 0.012323642821740255, -0.3613715829994197,
        -0.6520104899254531, 1.1500641632479522, 0.11480411675389499,
        0.37929728325133344, -0.12818017639377846, 1.5548403554359806,
        -0.08803696907532751, 0.16058007713541472, -0.2835300528775952,
        1.4317946638041426, 0.04218231832431045, 0.6164913379423986,
        -0.5546192578057587, -0.0016176435191898148, 0.3455446109244303,
        -0.7983090776945799, 0.06548494602750325, 0.09601011255154575,
        -1.274882751616874, -0.6639296860891427, 0.08468574728059233,
        0.09178155492125434, -1.9746588496307496, 1.363083624655819,
        -0.11754172722968637, -1.7454296260872237, 0.689437867548643,
        0.09536601432398076, 2.1875690275532618, 1.9737367040865754,
        0.19623670188051764, 1.3618525198389628, -1.6551377680800423,
        -1.2796187335858575, -0.02979150349567955, 0.3655877448114123,
        -1.339933806945279, -1.6131280858420662, 1.1268021774842836,
        0.7853899025443938, -1.214954346638235, 1.881374469676006,
        -2.2108375055617597, 0.38299461206746305, -0.062378913993248956,
        -1.0812916442950207, 0.19113842494911862, 0.43947065709017896,
        1.4340329690981122, -2.1914706359927933, 1.683520172253517,
        -0.4151753501170658, 0.2652280013518245, -0.09829123134965576,
        -0.4033858255054015, -0.09488290407421365, 1.1087820722198931,
        1.3758250784849964, 0.3693308876448478, -1.4774754586810708,
        0.45790576106810227, -1.318961759734687, 1.2898775251023542,
        0.5291693857421421, -0.7225860054677886, -0.6024865845145562,
        1.1258609582335735, 1.4545810101615688, 0.4988359655120556,
        0.39968483637691726, 1.4778005154845164, 1.6358502222921723,
        0.07081811420225437, 1.5336807499569445, -0.7595143926860392,
        0.07947795439670366
      ]
    ]

CONFIG_PATH = "exp.auto.yml"
STATIC_PREFIX = "AUTOMATE_ising_noisefree_time_evo_ric3"  # Output file prefix
NUM_RUNS = 10  # or len(OPTIMIZED_PARAM)
RIC_MUL = False  # Whether to remove RIC columns from data points

# === HELPER FUNCTIONS ===

def set_output_prefix(config, index):
    """Set output filename prefix in the config for the given run index."""
    sample_tag = f"{STATIC_PREFIX}_sample#{index + 1}"
    config["output"]["file_name_prefix"] = sample_tag
    return sample_tag  # return it so we can use it to load output

def set_init_param(config, param):
    """Set the init_param value in the config."""
    config["init_param"]["value"] = param

def run_main():
    """Run the main.py script with the given config."""
    subprocess.run(["python", "main.py", CONFIG_PATH], check=True)

def load_output_json_by_prefix(prefix):
    """Load a single JSON output file by matching its filename prefix."""
    base_path = "output"
    if not os.path.isdir(base_path):
        print(f"[!] Directory '{base_path}' not found.")
        return None

    for root, _, files in os.walk(base_path):
        for file in files:
            if file.endswith(".json") and prefix in file:
                file_path = os.path.join(root, file)
                try:
                    with open(file_path, "r") as f:
                        data = json.load(f)
                        print(f"[+] Loaded {file_path}")
                        return data
                except Exception as e:
                    print(f"[!] Failed to load {file_path}: {e}")
                    return None

    print(f"[!] No output file found for prefix: {prefix}")
    return None


# === MAIN AUTOMATION LOOP ===

def main():
    for i in range(NUM_RUNS):
        print(f"\n=== Running redundant + zne iteration {i + 1}/{NUM_RUNS} ===")

        # REDUNDANT RUN
        with open(CONFIG_PATH, "r") as f:
            config = yaml.safe_load(f)

        config["run"] = "redundant"
        prefix = set_output_prefix(config, i)
        set_init_param(config, OPTIMIZED_PARAM[i])
        config["zne"]["data_points"] = None

        with open(CONFIG_PATH, "w") as f:
            yaml.dump(config, f, sort_keys=False)

        run_main()

        # LOAD OUTPUT JSON
        data = load_output_json_by_prefix(prefix)
        if data is None:
            print(f"[!] Skipping zne for sample#{i + 1} due to missing redundant output.")
            continue

        # ZNE RUN
        optimized_param = data["config"]["init_param"]["value"]
        data_points = data["output"].get("data_points", None)

        print(f"Data points from output sample#{i+1}: {data_points}")

        with open(CONFIG_PATH, "r") as f:
            config = yaml.safe_load(f)

        config["run"] = "zne"
        if not RIC_MUL:
            config["zne"]["data_points"] = data_points
        else:
          cleaned_data_points = [row[:2] + row[4:] for row in data_points]
          config["zne"]["data_points"] = cleaned_data_points

        
        set_output_prefix(config, i)  # same prefix
        set_init_param(config, optimized_param)

        with open(CONFIG_PATH, "w") as f:
            yaml.dump(config, f, sort_keys=False)

        run_main()


if __name__ == "__main__":
    main()
