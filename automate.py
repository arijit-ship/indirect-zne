"""
Automation for redundant and ZNE runs.
"""

import os
import yaml
import json
import subprocess

# === CONFIGURATION ===
OPTIMIZED_PARAM = [
      [
        5.745892868760958e-17, 1.1709383462843448e-17, 0.048889352023190266,
        0.8489518534715456, 0.8489518534715456, 1.208956144268981,
        2.0666972122327496, 2.072850112103615, 2.5605903212089016,
        2.7762611132106176, 2.777935709919978, 3.5317156853956937,
        4.408768689229651, 4.442125912718341, 5.801310551947503,
        5.801310551947503, 6.012985738683818, 7.102516762859884,
        7.102516762859884, 8.519528892376478, 8.519528892376478,
        8.519528892376478, 8.519528892376478, 8.624636317958029,
        8.971168031835168, 8.971168031835168, 8.971168031835168,
        10.773165356419927, 10.863862970576116, 12.20207519780159,
        1.7540519003967505, 0.231729380502783, -0.6504622544532457,
        0.03309260955384709, 1.3575678292527422, 0.5027507166619888,
        1.0378291960674673, -0.64745155118707, 2.544878302582542,
        -0.403930176461227, 0.043397723710104745, -1.1904920234632104,
        1.1184321796625716, 0.7498947106074633, 0.9889595276909005,
        0.2875642817441963, 0.03752784505388665, 1.2132599174073173,
        -1.2878458273322695, 0.7738062305035216, -1.0364498338489312,
        -1.4251374965194816, -0.011812150156853458, 0.34193327766115816,
        0.4165047202379144, 0.8347866801063532, 0.01723095933186504,
        0.5924566047571479, -0.26293200341700607, 0.13078913441071555,
        0.11853521946991559, -2.0219128567707867, 0.8486170089752122,
        1.283073636815301, 0.6477834311588863, -0.5589620436188156,
        0.028359112235721066, -0.03865939662976266, 0.015329368965094396,
        -0.8890511991980924, -1.1322353087348074, -0.6585402477805538,
        0.3055426775951319, 0.5717046140506392, 0.30354714199597327,
        0.6367073471325857, 0.8958877462229936, 0.013127607298137214,
        -0.44840857001473294, 0.47542811801924495, 0.8140216355396612,
        -0.2947307522942167, -0.641406595933283, -0.14114791472772295,
        0.39078894055195823, -0.006553649342085041, 0.14887703736926367,
        0.16473154692152978, -0.0395979780868575, -0.04254724227717041,
        0.5889764208533399, 0.39077886044824167, -0.8306931051641692,
        0.4611986995745044, -0.08083147769499113, -0.6098318833001002,
        -1.2408757831087414, 0.16942325563304667, 0.23492728593125764,
        0.017160626711107387, 0.8391686766413652, -0.5593021433699098,
        0.6169384301829531, -0.0519516388204097, 0.12503619643120384,
        -0.37234688230626006, -0.20570357560763972, 0.11233736227941553,
        -0.13982229483383649, 1.5382900956102386, -0.13728867610277065,
        -0.2923516251203342, -0.10199224959198226, 1.1770475531365832,
        -0.06096188878454335, 0.36136407792143227, -0.05833873874091504,
        0.4413251906576549, 0.730398318102773, -0.21382091939661527,
        0.7975593757106056, 0.0906693180531793, 0.6180690797581276,
        0.4302454112196792, -0.29263765092738236, -0.6703442643755378,
        2.046592537660829, -0.655054321167014, 1.1205540052931446,
        -2.0015799572421664, 0.13910467905408497, -1.2735770219997444,
        -0.5874487732355872, -0.7343909143149352, 0.24389084368036226,
        0.6468791526012967, 0.06996236203964822, 1.471084515159668,
        -0.5172096875419676, 0.1339986874901603, 0.6672213381473122,
        -0.4697625485934508, -0.8496053812896432, 1.3434482289038951,
        -1.2165919714364897, 2.0086846735176915, -0.292500973568719,
        0.5070432330816532, 0.6291192953172425, 1.2241310222489905
      ],
      [
        5.953950263573904e-17, -9.590193429650138e-17, -9.46554070808165e-17,
        -9.518956842804835e-17, 0.07769368354582633, 1.1228049878223727,
        1.5920349107013358, 2.3348172850702027, 2.6853785849127543,
        3.6322331517566164, 3.663850835369189, 3.7291721315115107,
        4.675821821880445, 4.6800607889392465, 5.86271263651243,
        5.86271263651243, 5.897282877576186, 6.621996990731275,
        6.621996990731275, 7.399428780809913, 7.748824337390785,
        7.748824337390785, 7.935012034271967, 8.517123944801439,
        8.517123944801439, 9.53877409190696, 9.898756022750014,
        10.421451028920519, 10.421451028920519, 10.733904692834063,
        0.8701141393099482, -0.12551313465592004, -0.15310924202314583,
        0.043127928011857025, 1.8594906558754805, 3.1657038033707163,
        -1.7685986123076298, 0.2021414010685675, 0.9191171537517872,
        0.40516910588316063, -1.233511526180007, 0.10454615118912272,
        1.0225460438525142, 0.33596146781742614, 0.8698941558985948,
        0.12890359984857863, 0.9044510854695018, -0.4349031729015804,
        1.2082798165249162, 0.5902511599171382, 0.803415684537802,
        -0.287132993397591, -0.16442127463399478, -0.30590689576306873,
        0.5665847528139457, -0.7101965312894647, -0.5865217438453293,
        0.2513122353093728, 0.19363289708827416, 1.2255310833232111,
        0.1756104713598546, -1.0789971571310022, 0.37090543120492264,
        0.10441421795504569, 2.0473651699255795, -0.2478316744520022,
        -0.6796484364315024, -0.0690326381846991, -0.18147730394531536,
        -0.47272095724024016, 1.167033300507306, -0.5408800284696167,
        0.08500623786171127, -0.16095085175472465, 1.83257140044788,
        -0.4221838914475785, -0.8926949266146634, 0.14311561271198545,
        -0.8083077444496979, -0.11650522293168322, -0.5639667522606828,
        -1.3737002682842416, 0.1616005304319695, -0.1154995476890191,
        1.0843679054208089, 0.6155996581432606, -0.7173708196003613,
        -0.6377915561650724, 0.46862082836736824, -0.7765610500449178,
        0.7463047865317176, 0.7861905074314111, -0.03278399981634575,
        1.1593348274562654, -0.33141127984712077, 0.8868873915351262,
        -1.6751888983190015, 0.23753670513801603, -0.999626462320321,
        0.157945737514037, -1.0518809908468532, -0.12233118126463391,
        0.1868263671089172, -0.3971732434451098, -0.10310288838054198,
        0.34795322278812785, -0.09961618476684564, -0.22897341312929245,
        0.037752583627782665, 0.1646990033047471, 1.580748754328979,
        0.527166951855916, 0.5478366585206681, 0.4764287770122812,
        0.4873122182162858, -0.19051914513672127, 0.3095906781530284,
        -0.9877877555602784, -0.22206736449269426, -0.3880663970982876,
        0.06229910737884822, -0.5328981491475614, -1.2896673787220354,
        0.6153422549043854, 0.026416894650398252, -1.024643357124964,
        -0.04412462768740225, 0.3525589295938933, 0.29163724637428107,
        0.2607573504112131, -0.8161683907743091, 0.5463303320517424,
        -0.5124284408440882, 1.2559555427221316, -1.3338862301257401,
        -1.5672977229671807, 0.01253362847317139, -0.020931717005227148,
        1.5544406780321813, 1.042322766799952, -0.4679119434537583,
        -0.07339950469593082, -1.602595463717576, 0.0637877258776711,
        1.4175802927758197, -0.36332022405951725, 0.3901133515147793,
        1.3235234219525587, 1.4498368467471803, 1.0712727480467568
      ],
      [
        0.1674973459086645, 0.16749734590866466, 0.5011941362071803,
        1.2743391615242454, 1.2743391615242452, 2.1675625144249904,
        2.167562514424991, 2.46802201151225, 3.2155052575251775,
        3.2155052575251784, 3.2155052575251784, 4.572827842267289,
        5.175350943150605, 5.3188526042087165, 5.9519393654699195,
        5.9519393654699195, 5.95193936546992, 5.97603150551799,
        6.248071978721182, 7.228659057049855, 7.228659057049855,
        7.228659057049855, 7.465654486578341, 7.465654486578341,
        7.465654486578341, 8.430259368642105, 8.43183802156302,
        9.080304438933862, 9.431511715925447, 10.078990934298737,
        1.6179204474208262, -0.04316761619134945, 0.3559904865281999,
        -0.3400193665826288, 1.9840420942142307, 2.6275912891318476,
        -2.8752062079668868, -0.5423278716664116, -0.6451205182641697,
        -0.053500864398468455, -0.23613030363832266, -0.26748934964417864,
        2.2826682649369845, 0.6855987392134927, -0.3118553807809451,
        1.0782950580346025, 0.8991697099695117, -1.2449298079867084,
        0.14728784235233025, 1.972884064097805, 2.0814030490873257,
        -0.031117223137799757, 0.9330121142464733, -1.150557088250763,
        0.7508220142381647, 1.5568055920605959, 0.22425524084141069,
        -0.3309471212808259, -0.7642523432729673, 1.6971223813685377,
        0.9367170879526732, -0.48586443251692324, 1.2597485266324135,
        2.752023184054084, -0.30797960852044864, -0.044858210509438674,
        0.6335160769143388, 2.9269001880811003, 0.31189658848337337,
        0.2716203847682821, 0.7498468271018006, 0.7670977463350874,
        -1.399201784354584, 0.7443001129923383, 0.6102060789062839,
        -0.4635416383759911, -0.2598367099264497, -0.02055674778628673,
        0.6073027006985965, -0.4169917814400187, -0.2959216302796816,
        -0.02263506805042831, 0.45644677253645805, 0.47603927464768514,
        0.09477646303229384, -1.3171923766163443, 0.280897313840882,
        0.5366088624144534, 0.6657980559413821, 0.6192503542755783,
        -0.7733945907529162, 1.0046379105963381, 0.9664288712515617,
        -0.03891567125407012, 0.9436587934019486, 0.8484692586608634,
        -0.6533114682607227, -0.9773592410533207, 0.18584910813504135,
        -0.07672566019518705, 0.33705060953251653, -0.6491578381882701,
        0.45026205238730743, 0.43415692598988154, 1.1480815299566394,
        1.4474462263603693, 0.03528844415662663, -1.6068817733686145,
        -0.12463595645806907, -1.167969554540236, 0.6278077888355246,
        -0.38292241312447345, 1.0761385909426775, 0.837804545865467,
        -0.5535692648062868, 0.8032956619315825, -0.1844815073276062,
        0.04728576191705375, 1.8092625735405465, 1.2255817448324315,
        2.5206580015246036, 1.1752119584750083, -0.569579052702099,
        1.3738024669938962, -0.7377178676884713, -0.34637073993667034,
        -1.20557274588465, 1.0786147778025785, 0.010433690894005853,
        0.9949432793474314, -0.5291672171622901, 1.3104088330470258,
        2.4860814570830105, 0.9810355806078905, 1.081196233663323,
        2.537171071241429, 0.15202328357376382, -0.59691594700792,
        0.1634875336049144, 0.6887803946077025, 2.6365771236518265,
        0.9612238949226369, -0.48371403667054635, -0.6711732888063583,
        -0.4771122769144241, 0.7648059467553198, -1.200755778087195,
        -1.2043598656793117, 3.662387268844941, 1.1863593869564002
      ],
      [
        0.6603198584977938, 0.749587613311102, 1.5322609498549231,
        1.5322609498549231, 2.1481893112743435, 2.461360123822884,
        2.517163795702041, 3.0140286140622994, 3.018893241040464,
        3.018893241040464, 3.509747939187957, 4.568049337265842,
        5.6534490963872726, 6.543300646323311, 6.543300646323311,
        8.474977988497411, 8.484641570025982, 8.484641570025982,
        8.485755350079065, 8.485755350079065, 8.494922796877859,
        8.494922796877859, 9.072481894994267, 9.15398891038034,
        9.153988910380342, 10.540797572783596, 10.540797572783596,
        10.540797572783596, 10.540797572783596, 11.186392132009077,
        2.8341371454182647, 0.1326585817931482, -0.5234653075030156,
        -0.03274970863068882, 2.011650473968807, 0.17665550410243022,
        -0.7840065163147613, 0.42148531613540546, 0.33220220856451044,
        1.0457923611622044, -0.3918008231023166, -0.6114202934802639,
        3.0985034000265355, 2.6179922277626804, -0.6607807626403869,
        -0.9187849293709746, 2.7309619943255745, 1.276263860910922,
        0.42399790666745285, -0.2420830065996359, 2.230212982256147,
        0.05678367783785049, 2.573309503426788, 0.30913869003240957,
        3.7022893845924303, 0.6818367677218007, 1.8567633880428285,
        -2.067728350438796, 0.43264618091159707, 1.758044671798925,
        0.6250313094301114, -1.417340133817135, -0.8841317784246838,
        4.242189027990879, 1.3776931138412152, 0.19931271026434583,
        -0.5954342843085753, 0.21073450059506726, -0.9951773647449285,
        0.34950992587417284, 0.15032971000972803, -0.04402937222728395,
        0.13951389504714037, -0.3582994505124107, 0.24395855023675864,
        0.45071523091278093, -1.3657297792811887, -0.1990813815856761,
        0.2832938890772266, -0.4625342572526636, 0.23082003697986395,
        -0.10635548066805402, 0.5037291957115805, 0.43006983383883546,
        1.2854976759909946, -0.7692785395243213, 0.13424345770601132,
        -0.3773683251442285, 1.150205081264763, -0.24716534209156585,
        0.9981969278767382, -0.6668719801597139, 0.14333210283153772,
        -0.2554048974650853, 1.6779126125421917, 1.2737306972359959,
        0.31506406025295575, 0.45819408766601943, 0.8596004637254878,
        0.6988831331504045, -0.2616098096924304, -0.09996837432029065,
        1.1618186787445903, 2.487973054982389, 0.3837405844847518,
        -0.04147409835847511, 1.2971498209185035, -0.5896751086808888,
        0.45743354834986166, 0.09834292382819913, 0.5140690793961501,
        0.3365555412165169, -0.014801659903490888, 0.22207284500751676,
        -0.036264739255814714, -0.9402785396343876, 0.1848025483303649,
        -0.4497720848382748, -2.9203825881102836, -0.051256264069508305,
        1.2225373905885797, 1.2768349019307537, 1.087750743722253,
        1.4576934139911912, 2.9052556569250982, -0.06399322829813432,
        -0.032570978009733575, 1.1214991946316364, -0.3221360560485178,
        2.4544483253001905, 0.7768487940330944, 1.095262591712364,
        -0.08957665425757921, -0.2238927622041006, -0.6349680443682797,
        0.08766984230193531, 0.13003817966418074, 3.1306687514364193,
        0.998596415574352, 0.14145074959977558, 1.3597567799467887,
        1.243884667370207, -1.2432728759385234, -0.6546627406103438,
        1.7880007746153026, -0.43128967952847824, 1.527440712384765,
        2.1408403798840494, 1.2449824422876345, 1.2881882263353928
      ],
      [
        0.33143299805017534, 0.33143299805017534, 1.7141738324162894,
        2.5573727359133676, 2.5573727359133676, 3.314558465599441,
        4.317730720221926, 4.360009939708583, 4.360009939708583,
        4.360009939708583, 4.437963426836931, 4.860411821261644,
        4.8604118212616445, 6.018221834662885, 6.018221834662885,
        7.1262568021042005, 7.142157903610849, 8.337140845566202,
        8.337140845566202, 8.337140845566202, 8.337140845566202,
        8.799096937438039, 8.852660497943353, 9.507544786967568,
        9.507544786967568, 9.858932509563292, 9.961473356988016,
        9.961473356988016, 10.16001535833832, 10.883048718433512,
        1.1976265628854295, 0.42709283057970104, -0.14222661640478948,
        0.6543915280736458, 2.2569575685510546, 1.0446294576585358,
        1.063643872924739, -0.12578538021030367, 1.7683311698491069,
        0.24602928874702154, 0.1849391740094883, -0.19930390366433937,
        1.4832368696961111, -0.48422929671690457, 1.224957199251953,
        -1.0620709767306888, 1.7417773697186605, -0.35454408878189353,
        0.06494108154389788, -0.5990583569996979, 0.14021472016632217,
        0.353330866431738, -0.2591267455346916, 0.26584561971403525,
        0.2818045541511686, -0.13240428464170428, -0.27437242203596246,
        0.7843700151146088, -0.02196188011148926, 1.6851748615355095,
        0.048678711130821305, 1.594121467837275, -0.02790558124155581,
        1.4085975098287011, -0.14700468781391846, 1.275698834315286,
        -0.032891823358936145, 2.0563979482172567, -0.2919293329198304,
        0.6875779234166174, -0.2672918618544991, 0.2469354194227992,
        -0.5264104536381025, 1.040772091853122, -0.15019019799803243,
        0.12784471563595096, -1.2251494860232475, 0.5151009611274571,
        0.04638791702467762, -0.4703532790510485, -0.4480012763239679,
        -0.046010754519168945, 0.22458609013458872, -0.11046462812766865,
        0.4101630630795879, -0.971716315092691, 0.5527471491570318,
        0.15121406394426803, 0.9294232883519143, 0.09209578180199711,
        -0.7563254066426889, 0.6578801836321121, 0.11420036761758215,
        -0.10381263477760408, -0.8263526735000518, -0.40664362050433595,
        0.7171424775286416, 0.3405812698338144, -0.16130893455139672,
        -0.3062569009321463, 0.3501711139587176, -0.28188510794610566,
        0.19627765495537264, 2.512120306696253, -0.3392497111500733,
        -0.5684457570373146, -1.1259566108861545, 0.35791102444124745,
        1.1692354072437814, 0.5807118098120734, 0.16407951325260656,
        1.831510541831425, 1.3651611556158043, 0.7914801081544338,
        -1.5195192184500677, -0.37548155765632113, -1.1105938601613141,
        -0.4118292144456488, 0.09326266605548532, 1.0842363025483068,
        0.9366098900429399, -0.8894895717431963, 0.7025036333639905,
        2.693032800933735, 2.2070014260367277, 0.009230506358440138,
        0.3180967073105839, -0.07784775576434752, 1.556475718236876,
        1.8919921133686615, 1.626607405322276, -0.7853617280565216,
        0.3022151389893187, 1.0240336753647228, 0.446069386898085,
        -1.3423939992807563, 2.6505008316908323, 1.3522380319619534,
        -1.0006676404876256, -0.9121866479162719, 2.3472156239658983,
        0.3414255951201716, 0.5261425388489392, -1.8933981942478768,
        1.921054799001283, 0.1092115416850728, 2.858014707390402,
        2.407924393390483, 1.375272588252205, 0.8658179691843861
      ],
      [
        0.4068377570371524, 0.4068377570371523, 0.907378232057588,
        0.907378232057588, 0.907378232057588, 0.9073782320575879,
        1.3235806330611108, 1.6154380975007931, 3.0134741572841843,
        3.44362313652426, 3.4436231365242596, 5.0429501950643285,
        5.059494377292351, 6.50364063602273, 6.503640636022729,
        6.5036406360227295, 6.5036406360227295, 6.5036406360227295,
        7.660407616092366, 7.660407616092366, 7.660407616092366,
        7.660407616092365, 8.611615992188426, 8.611615992188426,
        8.940364197640651, 8.940364197640651, 10.827720533689517,
        11.058406378589721, 11.184752636784737, 11.323839621532766,
        3.109397089024676, 0.38277739948897777, 0.26320988007008184,
        -1.4084004601517428, 0.2319084092399653, 1.4027987827659913,
        0.49289202052989667, -2.66865446784846, 1.4445501567359718,
        0.4508849238365598, 0.8397120265166128, -0.858222140154229,
        1.1798027785743423, 3.381700270968396, 0.3841836333106631,
        -0.12363615820783568, 2.700318216244036, 0.2423264899229464,
        -0.3093460376167284, 0.24546217977534476, 4.123229601524674,
        0.8401287505798491, -0.32560854809526407, 0.30655978347208146,
        0.20724085640498222, -0.2014730307059024, 0.640759737408012,
        -0.8859076658745466, 1.9995697173124105, 0.11281218774023338,
        0.8925877794154571, -0.014695257396553568, -0.026732947284179357,
        0.3150024115845212, 0.08974812004432035, 0.3938673357625939,
        -1.6919340956197, 0.16020510820027675, 1.1128980205233185,
        0.08764080495862257, -0.3658989688015921, 0.41041292818916225,
        -0.06388579099944586, -0.022862100754878226, 0.6305703406609855,
        -0.3590571870845777, -1.8256196813523273, 0.2945859775678891,
        0.34073756297719354, -0.16251397767751324, -0.9946719677228323,
        -0.08921767522598902, -2.2623449903836317, 2.1258054496668115,
        1.008553231186682, 1.44134132120346, 1.1024478074255355,
        1.7438836554319248, -0.6732802267924761, -0.44351075639066195,
        -0.1657511728736472, 1.4995490058733982, 0.44139747009916186,
        1.136450013681514, 0.7383441000606061, 0.9529594874505132,
        -0.01749477919436683, -0.0604769885183004, -0.16250438294685352,
        0.055957508476730256, 0.23423353431772378, 0.24166096314544838,
        0.9869401957085078, 1.0807499405200758, 0.32178581347557167,
        0.9474284660317045, 1.761765174083859, 1.054300809037091,
        -0.5920389831192726, -0.2826972390246759, -0.6553627398662142,
        2.4505092960596877, 0.7263604558801735, -1.915724928652757,
        -0.42729062007020246, 0.32672433538243606, -1.838411419539518,
        0.9977759562682212, -0.5523863829022363, 0.9454113234401387,
        1.4031424944683166, 1.2538109068684866, -0.17740917722726426,
        0.22478484886543185, 0.31062505800300183, -2.055325161802634,
        1.2996265955028947, -0.16199855297205717, 2.0225199219599617,
        0.46813099629297017, 0.9127332458584405, -0.18062323653291992,
        0.14967030761403644, 0.49207588706352035, 0.41108822926709043,
        0.2855546990667059, 2.412341266509187, 3.3968394723498276,
        0.23204178019965063, -0.6420485851166654, 0.4724800437333735,
        1.9061169917079628, 0.5582024758588279, -0.6878218554936244,
        0.9718621753396598, -1.4374408741580211, -0.4590548345314897,
        0.7642553375279114, -0.1666399523630069, 0.9519284593042507
      ],
      [
        1.4471227189679314, 1.4471227190760736, 1.4471227190803815,
        1.4488504611176574, 1.9980017997211652, 1.99800179972548,
        2.4644327719246104, 2.464432771924611, 2.4688593917035817,
        2.4688593917049944, 2.9008854140044766, 2.9008854140044824,
        2.9011242267377266, 3.523074560046347, 3.654436511385456,
        5.545531084711811, 5.545531084711814, 5.545531084712091,
        5.928549371859526, 6.269772797789931, 7.6356014564056265,
        7.635621723143949, 7.635621953626072, 8.384891547978741,
        8.427677533896144, 8.427677535997198, 8.427677535997198,
        9.245883176470016, 10.569345605171868, 10.95729823806972,
        1.5231942014867916, 3.271292053255217, -0.6639893063125699,
        -0.9425765474118455, 2.621157322667308, 0.8962569724103042,
        -0.2229347338912776, -1.6929828589048135, 1.01350037576726,
        1.3901974486672235, -0.989424204037291, -0.8510250027060778,
        2.070175339071878, 0.22428819576801617, 0.3430034956795508,
        -0.0975183937426877, 2.6792827978105285, 0.49762902439121476,
        0.3806128804344224, -1.5166355570867067, 0.03285447922521971,
        1.6257976354431922, -0.07195559038347954, -1.0306131493497783,
        0.7770166950065824, 1.4702421230343108, -0.19123065460178676,
        -0.9493367985317367, -0.360982455055411, 0.5675310885195264,
        0.043444789555278196, -0.09384794053031004, -0.33362668429892167,
        1.8361662224149309, 0.14418206157800617, -0.2063739050751399,
        0.13194231020455127, 2.7516256882851544, 0.42538616216432723,
        -0.07570851266773582, -2.466588986393277, 2.7498575331560176,
        -0.48074177453072725, 0.699557508567697, -0.011764775537334213,
        1.2456263327933796, 0.29568948754988306, 1.5296237559643826,
        0.0640064257606478, 1.9191058225093236, 0.6235789879012194,
        2.3106885302232474, -1.4143743772916317, 0.7046688644446398,
        -0.02136062976080129, 0.8277708314134835, -1.308616852623268,
        0.11732737635430505, -0.18559721456790204, -0.6081453251998182,
        0.27499508619397406, -0.12252651641235691, 2.4435816923969695,
        2.370150376162669, 1.5637678972206062, 1.5561040198661897,
        -0.17566603135636366, -1.3812257093127966, -0.015566000377598834,
        0.2272027837145364, 1.3196821415940994, 2.650124815272399,
        0.014453583656207258, 1.6542995766090498, 0.36986370888553005,
        1.8887812729839575, -0.8205962054480542, 0.24888505205313302,
        2.4276851066876537, -0.3600879337027825, 0.8890320447947508,
        3.097996523563487, 1.0769359910889715, -0.06124520642947073,
        -0.4520231845185361, -0.440987109417669, 1.404732555719411,
        -1.1285564620342403, 0.13336475261879757, 2.9990283140023934,
        -0.9935619973526759, 1.307814939437824, -0.40085216386367967,
        0.6152666468211251, -0.7962816439431518, 0.8528908169058572,
        2.594903745366319, 0.09267741506712654, 0.4502565360836063,
        3.396440029785719, 1.336627241328244, -1.0915504248924435,
        0.44656464088575704, -0.14576166703684298, 0.4990870054261387,
        0.7506479665553083, 2.56280521658955, 3.602053419533154,
        1.5886330866264686, -0.7364615879474211, 1.7886824336525127,
        2.1557316351374975, -0.47627881561464136, -3.8285310214465795,
        0.45565275134526295, 1.4209428833725541, 0.2692567134559917,
        0.1853811053495894, 2.8243404617308605, 1.5932817601338924
      ],
      [
        0.13798571469690482, 0.1379857146969049, 0.9857910490623445,
        1.681118844275678, 1.7520739657402942, 1.7520739657402942,
        3.560031235891461, 3.5600312358914605, 3.5648389510958896,
        3.5648389510958896, 5.748733954467001, 5.748733954467001,
        5.74895012373235, 6.486061737078783, 6.552923155698712,
        6.552923155698712, 6.552923155698712, 6.552923155698712,
        6.552923155698712, 6.552923155698712, 6.552923155698712,
        8.361072992395593, 8.361072992395593, 8.361072992395593,
        8.4869439232542, 8.487442874430897, 8.493708461368103,
        9.661256623254111, 9.740818964261404, 10.473326671271314,
        2.9636387449395936, 3.745956961421834, -0.019995937319558517,
        -0.9149659720056588, 3.920525494029825, 1.1639441886828594,
        -1.3671178133249895, -1.6742860973247342, 4.782366166466018,
        0.05104322143804055, 0.48861233229129936, -0.5435329689317034,
        2.1153017076047593, 0.7329874108404706, 3.423461748546137,
        -0.383375665027055, 1.8180334550559423, -0.8648326905886491,
        0.5168084871927063, -1.7871513146651212, 0.6829395672039243,
        2.2464447671634167, 2.5262079780830176, -2.1925242220773873,
        -0.3022622906416338, 0.05992487439938436, 1.8649553379310186,
        -0.20402986627054603, 1.6457257876607136, 2.202939972959756,
        1.8543518382866748, -2.1080070310211885, -0.9246167225909663,
        1.9276481635471059, -1.6146037024313, -1.225798320318001,
        2.448619349738463, 2.880342048111337, -0.30594336758744134,
        1.7658585171985814, 3.194869797457559, -1.2821634491722693,
        0.18771052247989828, -0.9383095264449728, -0.1858764571826665,
        -0.9040812021278273, -0.27195322988032267, -2.1853592473814505,
        3.028158695550384, 1.2403714062159124, -0.22308945940883124,
        -0.5586602667491722, -0.24681035583520874, -0.11138534164542646,
        -0.15139604941549326, -0.3427653514034584, 3.178925091454309,
        -0.011063503211333566, 2.363579233085362, -0.1357825684812748,
        0.0639603309158904, 0.3392950354111796, 0.820386609455778,
        0.4911578237709962, 0.025662180356183527, 0.7188231061819643,
        -0.053489551356192516, -0.699399038710116, 1.16191745690214,
        -1.055909130935087, -0.6788138306552922, 0.3382306604857817,
        2.0341148785065393, 3.1744117027592433, 0.13187801162689275,
        0.1640079167373998, 0.8686909960681891, -1.609057644222547,
        -0.2722169441120501, -2.7828135017988784, 0.3743849827071679,
        1.6874546244899586, 0.5857594998231057, 0.6860752934177077,
        -0.16715454089741993, 1.1822296666904561, -1.4327549192226787,
        0.27604898002965633, 1.1054976564997352, 2.839566338418435,
        1.644251358059053, 1.3666770066524674, 0.7728825745782069,
        0.6377695993604517, -1.763309925151641, -0.42970531312780114,
        -0.1838655251516677, -0.7821911460099792, 2.396200160863748,
        1.2583700603099746, 0.8831131574794207, 0.5963597602504539,
        -0.14981538092383753, -0.055561606964170486, 0.7817993416934266,
        -0.1677477896480692, 2.479314955757844, 1.723437170002211,
        1.026900731952517, 1.5488459636310634, 1.086150492076512,
        0.6541092387611163, 0.6183219764434555, 0.859384391275448,
        2.354813748620494, 3.7322795293007425, 1.3350310542539618,
        1.7992895318869657, 2.001054725587102, 1.5138887416863898
      ],
      [
        0.024071783932460462, 0.024071783932460546, 0.6571300838376971,
        0.6571300838376971, 2.847267167217975, 2.847267167217975,
        2.847267167217975, 2.847267167217975, 3.5841779763700368,
        3.5841779763700368, 3.654183405890931, 3.6541834058909304,
        3.654183405890931, 4.60732877730885, 5.779983685744588,
        5.779983685744588, 5.779983685744588, 5.779983685744588,
        6.975592444909562, 7.373747431648411, 7.373747431648411,
        7.8885563138316614, 7.973445964966676, 7.973445964966676,
        9.277335519457589, 9.277335519457589, 9.863509219663603,
        10.013515001994083, 10.428050723329033, 11.158973328223576,
        3.414158119993233, 0.7136317932112352, -0.5215169977503067,
        -0.8694289421728726, 1.677261393921285, 1.0498291556193011,
        0.06610987070224317, 1.6448458506492722, 2.1325229191423576,
        0.8717934989072182, -0.017473157434604498, 1.2971225067988037,
        3.367090306276093, 0.6575500524774545, 0.009096565499267578,
        0.0023336265751655594, -0.08885846440096425, -0.0019451261434935661,
        -0.014605160962075554, -0.8749577579787783, 0.2885176011068368,
        0.9819338353628388, 0.24002642379273972, -0.39782653380841043,
        0.09575877132996519, 2.23147583419876, 0.07141665284864523,
        -0.9662932885431283, 0.14321182800665078, 2.448810484122819,
        0.1827137169630212, 0.26979513674505656, 0.039305806465168916,
        0.6035033227805163, 0.4420911054779434, -0.6322803067583783,
        -0.4519403709437152, -0.5005249145303325, -0.9579174425901728,
        0.48097334732123054, -0.537252907805262, 0.6700698572349401,
        1.7577947242132432, 0.802689231021676, -0.0595906046711367,
        2.341797281086153, 0.07940356283051389, 1.8550515062287172,
        0.2818021876393628, 0.8922244548529277, 0.9490001306910304,
        0.888479384861999, -0.22270480299889328, -0.03997781578390973,
        -0.1723576299305393, 0.1099267463858736, 0.4882167063545996,
        0.0744653535947252, -0.19517732684065053, -0.5259974164605723,
        -0.517347335074171, 2.445828266094393, 2.1341047099383927,
        0.7420915309084719, -0.8017500579493622, 2.5608971318277822,
        -0.9365641110876575, -0.5722081830415768, 0.3868674245022582,
        2.2725882469505665, -0.8442807301987474, 1.9240647817512537,
        0.2873095474767721, 0.30295539140633143, -0.44127643926676335,
        -0.18114839685230777, -0.5510426972023466, -0.11038560543846598,
        2.1149960784519264, -0.3735125894745773, -0.32632278700967476,
        1.3581988893120003, 1.1481286367123644, -1.172889923330688,
        1.5297107097981828, 0.3870472395238847, 2.9170993024578964,
        -1.2811295229188269, 0.20273691846810799, 0.1746454411349988,
        2.683763750007948, 0.5243357459971485, 0.052181725826758375,
        0.26241474241441237, 1.558842973192364, -1.5331841918554194,
        -0.3421045165844316, 1.7041413635040243, 1.5725459373163913,
        0.8440138477988423, -0.5119329454237443, -0.29846984149434475,
        -0.6048003071800283, 1.2167115482701463, -0.917864374905777,
        -0.5368225663176617, 1.9254314678841202, 1.7668388949117437,
        2.3011120958567073, 0.24256796965219266, 0.6203342770631703,
        -1.0899997813245097, 1.825104009234724, -0.33354564254912833,
        0.17013517795620187, 1.948796561112006, 0.2139299512818068,
        1.0710737685068699, 0.34954548287475173, 0.7408606516129334
      ],
      [
        0.035104460953320135, 0.06320608883010012, 0.11640589118160115,
        0.7589089238856431, 1.7255430659706923, 1.7255430659706923,
        1.7543049613133366, 2.8348908552383936, 2.89483562804989,
        2.89483562804989, 3.654573938871757, 3.654573938871757,
        3.980955574398588, 4.9930393397493855, 4.993158175733121,
        5.033535418832077, 6.256945475123218, 6.420405842787826,
        6.882101554478684, 6.882944211493092, 7.568004474576482,
        7.568004474576482, 7.681144720869446, 7.6811447208694466,
        8.423182897925638, 8.423182897925638, 8.537030447870652,
        9.315832470591172, 9.315890892198261, 10.28144569286365,
        0.06991279494787835, -0.04164497043390451, -1.498619740395282,
        0.01888238467525083, 1.2708754797133017, -0.11098980639935205,
        -1.5823056504798074, 1.068373599670342, 1.434585172904544,
        1.6046991132851038, -0.21117192981743552, -0.37824291845517205,
        0.8417126016263458, -0.08153805834441924, -0.11740486487384727,
        1.0725035265731215, 0.8003766370603339, -0.06206062036582436,
        -2.0079371952070244, 0.3536595938851569, 1.7073816846051888,
        0.09263800917192155, 1.007260621056069, -0.16547413629038304,
        -0.1554540799442901, -0.05465562676714224, -1.4972674380359752,
        -0.45971221485376457, 0.20927724210154383, 0.4330530095791882,
        -0.8248162334308756, 0.3067021844703226, -0.9220780032753414,
        0.0873603948852503, 0.6356467245686668, -1.1801873973540513,
        -0.36718241220864284, 0.35377150535421453, 0.6861630506375189,
        0.20176629253401723, -1.1636355068328854, 0.15001215061008663,
        -0.20840926535523177, 0.39693810512734384, 0.49771597007449225,
        0.006319435656346777, 0.0009536544546264541, 0.007135982582266386,
        1.0846367198421571, -0.21063212538099887, -1.0779071251619905,
        -0.6367451177078891, 0.5695744167415524, 0.31367905934223567,
        0.008791765346886606, 0.34431675858728555, 0.7264208877035511,
        -0.7943576739809853, 0.4475826877453903, -1.2978332901379934,
        0.4109082401153747, -0.8309204161009912, -0.09870103800747962,
        -0.19852433800524383, -0.06374598574568587, 0.6245161391285835,
        -0.27807310116844847, -0.2004280523050948, -0.01645841178693261,
        0.7179127942010819, 0.00976189564602963, -0.9480532007413072,
        0.7134024513357077, -0.37063960105584176, 0.5870397624146295,
        1.2576724343702212, -1.1120447601155916, 0.14172997495950415,
        0.4839131047524525, 0.5416377004675886, -0.32764702155180747,
        -1.1899533308439216, 0.4253137065123485, 0.2920805051395973,
        0.13849337517644342, 1.7865622892876831, -1.081237789398949,
        0.9013944775349032, -0.4014526093645061, -0.5590828749765706,
        2.1542705174030212, 0.5088727082202459, 0.5171760791892269,
        0.46785641447303894, 0.14609142268085523, 0.8062064471105469,
        -1.317470917353886, 0.03765756387965828, 0.514338051488177,
        1.0203766527754297, -0.4549195306435648, 0.0965646089533303,
        0.6124934759631742, -0.07572418397786075, -1.4147562625769505,
        -0.2162413857897775, -0.16433315219040734, 0.384636122589355,
        -0.08101162081300188, -1.2812661658797415, 1.2104130520562217,
        2.2549841788030225, 0.28162696641206897, 0.7815916192038784,
        -0.7589045295321298, 1.990255945445407, -0.15607253781673872,
        0.8494437736263586, 1.083165702728649, 2.193727289657894
      ]
    ]

CONFIG_PATH = "exp.auto.yml"
STATIC_PREFIX = "AUTOMATE_heisenberg_dephasing_ricmul"  # Output file prefix
NUM_RUNS = 10  # or len(OPTIMIZED_PARAM)
RIC_MUL = True

# === HELPER FUNCTIONS ===

def set_output_prefix(config, index):
    """Set output filename prefix in the config for the given run index."""
    sample_tag = f"{STATIC_PREFIX}_sample#{index + 1}"
    config["output"]["file_name_prefix"] = sample_tag
    return sample_tag  # return it so we can use it to load output

def set_init_param(config, param):
    """Set the init_param value in the config."""
    config["init_param"]["value"] = param

def run_main():
    """Run the main.py script with the given config."""
    subprocess.run(["python", "main.py", CONFIG_PATH], check=True)

def load_output_json_by_prefix(prefix):
    """Load a single JSON output file by matching its filename prefix."""
    base_path = "output"
    if not os.path.isdir(base_path):
        print(f"[!] Directory '{base_path}' not found.")
        return None

    for root, _, files in os.walk(base_path):
        for file in files:
            if file.endswith(".json") and prefix in file:
                file_path = os.path.join(root, file)
                try:
                    with open(file_path, "r") as f:
                        data = json.load(f)
                        print(f"[+] Loaded {file_path}")
                        return data
                except Exception as e:
                    print(f"[!] Failed to load {file_path}: {e}")
                    return None

    print(f"[!] No output file found for prefix: {prefix}")
    return None


# === MAIN AUTOMATION LOOP ===

def main():
    for i in range(NUM_RUNS):
        print(f"\n=== Running redundant + zne iteration {i + 1}/{NUM_RUNS} ===")

        # REDUNDANT RUN
        with open(CONFIG_PATH, "r") as f:
            config = yaml.safe_load(f)

        config["run"] = "redundant"
        prefix = set_output_prefix(config, i)
        set_init_param(config, OPTIMIZED_PARAM[i])
        config["zne"]["data_points"] = None

        with open(CONFIG_PATH, "w") as f:
            yaml.dump(config, f, sort_keys=False)

        run_main()

        # LOAD OUTPUT JSON
        data = load_output_json_by_prefix(prefix)
        if data is None:
            print(f"[!] Skipping zne for sample#{i + 1} due to missing redundant output.")
            continue

        # ZNE RUN
        optimized_param = data["config"]["init_param"]["value"]
        data_points = data["output"].get("data_points", None)

        print(f"Data points from output sample#{i+1}: {data_points}")

        with open(CONFIG_PATH, "r") as f:
            config = yaml.safe_load(f)

        config["run"] = "zne"
        if not RIC_MUL:
            config["zne"]["data_points"] = data_points
        else:
          cleaned_data_points = [row[:2] + row[4:] for row in data_points]
          config["zne"]["data_points"] = cleaned_data_points

        
        set_output_prefix(config, i)  # same prefix
        set_init_param(config, optimized_param)

        with open(CONFIG_PATH, "w") as f:
            yaml.dump(config, f, sort_keys=False)

        run_main()


if __name__ == "__main__":
    main()
